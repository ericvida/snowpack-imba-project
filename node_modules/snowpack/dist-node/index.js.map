{"version":3,"file":"index.js","sources":["../dist-src/util.js","../dist-src/resolve-remote.js","../dist-src/rollup-plugins/rollup-plugin-catch-unresolved.js","../dist-src/rollup-plugins/rollup-plugin-catch-fetch.js","../dist-src/rollup-plugins/rollup-plugin-css.js","../dist-src/rollup-plugins/rollup-plugin-remote-cdn.js","../dist-src/rollup-plugins/rollup-plugin-stats.js","../dist-src/rollup-plugins/rollup-plugin-wrap-install-targets.js","../dist-src/scan-imports.js","../dist-src/stats-formatter.js","../dist-src/commands/install.js","../dist-src/commands/add-rm.js","../dist-src/build/build-import-proxy.js","../dist-src/build/src-file-extension-mapping.js","../dist-src/plugins/plugin-esbuild.js","../dist-src/config.js","../dist-src/build/build-pipeline.js","../dist-src/build/import-resolver.js","../dist-src/rewrite-imports.js","../dist-src/commands/build.js","../dist-src/hmr-server-engine.js","../dist-src/commands/paint.js","../dist-src/commands/dev.js","../dist-src/index.js"],"sourcesContent":["import cacache from 'cacache';\nimport globalCacheDir from 'cachedir';\nimport etag from 'etag';\nimport execa from 'execa';\nimport projectCacheDir from 'find-cache-dir';\nimport findUp from 'find-up';\nimport fs from 'fs';\nimport got from 'got';\nimport mkdirp from 'mkdirp';\nimport open from 'open';\nimport path from 'path';\nimport rimraf from 'rimraf';\nexport const PIKA_CDN = `https://cdn.pika.dev`;\nexport const GLOBAL_CACHE_DIR = globalCacheDir('snowpack');\n// A note on cache naming/versioning: We currently version our global caches\n// with the version of the last breaking change. This allows us to re-use the\n// same cache across versions until something in the data structure changes.\n// At that point, bump the version in the cache name to create a new unique\n// cache name.\nexport const RESOURCE_CACHE = path.join(GLOBAL_CACHE_DIR, 'pkg-cache-1.4');\nexport const BUILD_CACHE = path.join(GLOBAL_CACHE_DIR, 'build-cache-2.6');\nexport const PROJECT_CACHE_DIR = projectCacheDir({ name: 'snowpack' });\nexport const DEV_DEPENDENCIES_DIR = path.join(PROJECT_CACHE_DIR, 'dev');\nconst LOCKFILE_HASH_FILE = '.hash';\nexport const HAS_CDN_HASH_REGEX = /\\-[a-zA-Z0-9]{16,}/;\n// NOTE(fks): Must match empty script elements to work properly.\nexport const HTML_JS_REGEX = /(<script.*?type=\"?module\"?.*?>)(.*?)<\\/script>/gms;\nexport const URL_HAS_PROTOCOL_REGEX = /^(\\w+:)?\\/\\//;\nexport function isYarn(cwd) {\n    return fs.existsSync(path.join(cwd, 'yarn.lock'));\n}\nconst UTF8_FORMATS = ['.css', '.html', '.js', '.mjs', '.json', '.svg', '.txt', '.xml'];\nexport function getEncodingType(ext) {\n    return UTF8_FORMATS.includes(ext) ? 'utf-8' : 'binary';\n}\nexport async function readLockfile(cwd) {\n    try {\n        var lockfileContents = fs.readFileSync(path.join(cwd, 'snowpack.lock.json'), {\n            encoding: 'utf-8',\n        });\n    }\n    catch (err) {\n        // no lockfile found, ignore and continue\n        return null;\n    }\n    // If this fails, we actually do want to alert the user by throwing\n    return JSON.parse(lockfileContents);\n}\nexport async function writeLockfile(loc, importMap) {\n    const sortedImportMap = { imports: {} };\n    for (const key of Object.keys(importMap.imports).sort()) {\n        sortedImportMap.imports[key] = importMap.imports[key];\n    }\n    fs.writeFileSync(loc, JSON.stringify(sortedImportMap, undefined, 2), { encoding: 'utf-8' });\n}\nexport function fetchCDNResource(resourceUrl, responseType) {\n    if (!resourceUrl.startsWith(PIKA_CDN)) {\n        resourceUrl = PIKA_CDN + resourceUrl;\n    }\n    // @ts-ignore - TS doesn't like responseType being unknown amount three options\n    return got(resourceUrl, {\n        responseType: responseType,\n        headers: { 'user-agent': `snowpack/v1.4 (https://snowpack.dev)` },\n        throwHttpErrors: false,\n    });\n}\nexport function isTruthy(item) {\n    return Boolean(item);\n}\n/** Get the package name + an entrypoint within that package (if given). */\nexport function parsePackageImportSpecifier(imp) {\n    const impParts = imp.split('/');\n    if (imp.startsWith('@')) {\n        const [scope, name, ...rest] = impParts;\n        return [`${scope}/${name}`, rest.join('/') || null];\n    }\n    const [name, ...rest] = impParts;\n    return [name, rest.join('/') || null];\n}\n/**\n * Given a package name, look for that package's package.json manifest.\n * Return both the manifestÂ location (if believed to exist) and the\n * manifest itself (if found).\n *\n * NOTE: You used to be able to require() a package.json file directly,\n * but now with export map support in Node v13 that's no longer possible.\n */\nexport function resolveDependencyManifest(dep, cwd) {\n    // Attempt #1: Resolve the dependency manifest normally. This works for most\n    // packages, but fails when the package defines an export map that doesn't\n    // include a package.json. If we detect that to be the reason for failure,\n    // move on to our custom implementation.\n    try {\n        const depManifest = require.resolve(`${dep}/package.json`, { paths: [cwd] });\n        return [depManifest, require(depManifest)];\n    }\n    catch (err) {\n        // if its an export map issue, move on to our manual resolver.\n        if (err.code !== 'ERR_PACKAGE_PATH_NOT_EXPORTED') {\n            return [null, null];\n        }\n    }\n    // Attempt #2: Resolve the dependency manifest manually. This involves resolving\n    // the dep itself to find the entrypoint file, and then haphazardly replacing the\n    // file path within the package with a \"./package.json\" instead. It's not as\n    // thorough as Attempt #1, but it should work well until export maps become more\n    // established & move out of experimental mode.\n    let result = [null, null];\n    try {\n        const fullPath = require.resolve(dep, { paths: [cwd] });\n        // Strip everything after the package name to get the package root path\n        // NOTE: This find-replace is very gross, replace with something like upath.\n        const searchPath = `${path.sep}node_modules${path.sep}${dep.replace('/', path.sep)}`;\n        const indexOfSearch = fullPath.lastIndexOf(searchPath);\n        if (indexOfSearch >= 0) {\n            const manifestPath = fullPath.substring(0, indexOfSearch + searchPath.length + 1) + 'package.json';\n            result[0] = manifestPath;\n            const manifestStr = fs.readFileSync(manifestPath, { encoding: 'utf-8' });\n            result[1] = JSON.parse(manifestStr);\n        }\n    }\n    catch (err) {\n        // ignore\n    }\n    finally {\n        return result;\n    }\n}\n/**\n * If Rollup erred parsing a particular file, show suggestions based on its\n * file extension (note: lowercase is fine).\n */\nexport const MISSING_PLUGIN_SUGGESTIONS = {\n    '.svelte': 'Try installing rollup-plugin-svelte and adding it to Snowpack (https://www.snowpack.dev/#custom-rollup-plugins)',\n    '.vue': 'Try installing rollup-plugin-vue and adding it to Snowpack (https://www.snowpack.dev/#custom-rollup-plugins)',\n};\nconst appNames = {\n    win32: {\n        brave: 'brave',\n        chrome: 'chrome',\n    },\n    darwin: {\n        brave: 'Brave Browser',\n        chrome: 'Google Chrome',\n    },\n    linux: {\n        brave: 'brave',\n        chrome: 'google-chrome',\n    },\n};\nexport async function openInBrowser(protocol, hostname, port, browser) {\n    const url = `${protocol}//${hostname}:${port}`;\n    browser = /chrome/i.test(browser)\n        ? appNames[process.platform]['chrome']\n        : /brave/i.test(browser)\n            ? appNames[process.platform]['brave']\n            : browser;\n    if (process.platform === 'darwin' && /chrome|default/i.test(browser)) {\n        // If we're on macOS, and we haven't requested a specific browser,\n        // we can try opening Chrome with AppleScript. This lets us reuse an\n        // existing tab when possible instead of creating a new one.\n        try {\n            await execa.command('ps cax | grep \"Google Chrome\"', {\n                shell: true,\n            });\n            await execa('osascript ../assets/openChrome.applescript \"' + encodeURI(url) + '\"', {\n                cwd: __dirname,\n                stdio: 'ignore',\n                shell: true,\n            });\n            return true;\n        }\n        catch (err) {\n            // If macOS auto-reuse doesn't work, just open normally, using default browser.\n            open(url);\n        }\n    }\n    else {\n        browser === 'default' ? open(url) : open(url, { app: browser });\n    }\n}\nexport async function checkLockfileHash(dir) {\n    const lockfileLoc = await findUp(['package-lock.json', 'yarn.lock']);\n    if (!lockfileLoc) {\n        return true;\n    }\n    const hashLoc = path.join(dir, LOCKFILE_HASH_FILE);\n    const newLockHash = etag(await fs.promises.readFile(lockfileLoc, 'utf-8'));\n    const oldLockHash = await fs.promises.readFile(hashLoc, 'utf-8').catch(() => '');\n    return newLockHash === oldLockHash;\n}\nexport async function updateLockfileHash(dir) {\n    const lockfileLoc = await findUp(['package-lock.json', 'yarn.lock']);\n    if (!lockfileLoc) {\n        return;\n    }\n    const hashLoc = path.join(dir, LOCKFILE_HASH_FILE);\n    const newLockHash = etag(await fs.promises.readFile(lockfileLoc));\n    await mkdirp(path.dirname(hashLoc));\n    await fs.promises.writeFile(hashLoc, newLockHash);\n}\nexport async function clearCache() {\n    return Promise.all([\n        cacache.rm.all(RESOURCE_CACHE),\n        cacache.rm.all(BUILD_CACHE),\n        rimraf.sync(PROJECT_CACHE_DIR),\n    ]);\n}\n/**\n * For the given import specifier, return an alias entry if one is matched.\n */\nexport function findMatchingAliasEntry(config, spec) {\n    // Only match bare module specifiers. relative and absolute imports should not match\n    if (spec.startsWith('./') ||\n        spec.startsWith('../') ||\n        spec.startsWith('/') ||\n        spec.startsWith('http://') ||\n        spec.startsWith('https://')) {\n        return undefined;\n    }\n    const foundEntry = Object.entries(config.alias).find(([fromAlias]) => spec.startsWith(fromAlias));\n    if (!foundEntry) {\n        return undefined;\n    }\n    return {\n        from: foundEntry[0],\n        to: foundEntry[1],\n        type: isPackageAliasEntry(foundEntry[1]) ? 'package' : 'path',\n    };\n}\n/**\n * For the given import specifier, return an alias entry if one is matched.\n */\nexport function isPackageAliasEntry(val) {\n    return !path.isAbsolute(val);\n}\n/** Get full extensions of files */\nexport function getExt(fileName) {\n    return {\n        /** base extension (e.g. `.js`) */\n        baseExt: path.extname(fileName).toLocaleLowerCase(),\n        /** full extension, if applicable (e.g. `.proxy.js`) */\n        expandedExt: path.basename(fileName).replace(/[^.]+/, '').toLocaleLowerCase(),\n    };\n}\n/** Replace file extensions */\nexport function replaceExt(fileName, newExtension, replaceExpandedExt = false) {\n    const { baseExt, expandedExt } = getExt(fileName);\n    const extToReplace = new RegExp(`\\\\${replaceExpandedExt ? expandedExt : baseExt}$`, 'i');\n    return fileName.replace(extToReplace, newExtension);\n}\n/**\n * Sanitizes npm packages that end in .js (e.g `tippy.js` -> `tippyjs`).\n * This is necessary because Snowpack canât create both a file and directory\n * that end in .js.\n */\nexport function sanitizePackageName(filepath) {\n    const dirs = filepath.split('/');\n    const file = dirs.pop();\n    return [...dirs.map((path) => path.replace(/\\.js$/i, 'js')), file].join('/');\n}\n","import cacache from 'cacache';\nimport * as colors from 'kleur/colors';\nimport PQueue from 'p-queue';\nimport validatePackageName from 'validate-npm-package-name';\nimport { fetchCDNResource, PIKA_CDN, RESOURCE_CACHE } from './util.js';\n/**\n * Given an install specifier, attempt to resolve it from the CDN.\n * If no lockfile exists or if the entry is not found in the lockfile, attempt to resolve\n * it from the CDN directly. Otherwise, use the URL found in the lockfile and attempt to\n * check the local cache first.\n *\n * All resolved URLs are populated into the local cache, where our internal Rollup engine\n * will load them from when it installs your dependencies to disk.\n */\nasync function resolveDependency(installSpecifier, packageSemver, lockfile, canRetry = true) {\n    // Right now, the CDN is only for top-level JS packages. The CDN doesn't support CSS,\n    // non-JS assets, and has limited support for deep package imports. Snowpack\n    // will automatically fall-back any failed/not-found assets from local\n    // node_modules/ instead.\n    if (!validatePackageName(installSpecifier).validForNewPackages) {\n        return null;\n    }\n    // Grab the installUrl from our lockfile if it exists, otherwise resolve it yourself.\n    let installUrl;\n    let installUrlType;\n    if (lockfile && lockfile.imports[installSpecifier]) {\n        installUrl = lockfile.imports[installSpecifier];\n        installUrlType = 'pin';\n    }\n    else {\n        if (packageSemver === 'latest') {\n            console.warn(`warn(${installSpecifier}): Not found in \"dependencies\". Using latest package version...`);\n        }\n        if (packageSemver.startsWith('npm:@reactesm') || packageSemver.startsWith('npm:@pika/react')) {\n            throw new Error(`React workaround packages no longer needed! Revert to the official React & React-DOM packages.`);\n        }\n        if (packageSemver.includes(' ') || packageSemver.includes(':')) {\n            console.warn(`warn(${installSpecifier}): Can't fetch complex semver \"${packageSemver}\" from remote CDN.`);\n            return null;\n        }\n        installUrlType = 'lookup';\n        installUrl = `${PIKA_CDN}/${installSpecifier}@${packageSemver}`;\n    }\n    // Hashed CDN urls never change, so its safe to grab them directly from the local cache\n    // without a network request.\n    if (installUrlType === 'pin') {\n        const cachedResult = await cacache.get.info(RESOURCE_CACHE, installUrl).catch(() => null);\n        if (cachedResult) {\n            if (cachedResult.metadata) {\n                const { pinnedUrl } = cachedResult.metadata;\n                return pinnedUrl;\n            }\n        }\n    }\n    // Otherwise, resolve from the CDN remotely.\n    const { statusCode, headers, body } = await fetchCDNResource(installUrl);\n    if (statusCode !== 200) {\n        console.warn(`Failed to resolve [${statusCode}]: ${installUrl} (${body})`);\n        console.warn(`Falling back to local copy...`);\n        return null;\n    }\n    let importUrlPath = headers['x-import-url'];\n    let pinnedUrlPath = headers['x-pinned-url'];\n    const buildStatus = headers['x-import-status'];\n    const typesUrlPath = headers['x-typescript-types'];\n    const typesUrl = typesUrlPath && `${PIKA_CDN}${typesUrlPath}`;\n    if (installUrlType === 'pin') {\n        const pinnedUrl = installUrl;\n        await cacache.put(RESOURCE_CACHE, pinnedUrl, body, {\n            metadata: { pinnedUrl, typesUrl },\n        });\n        return pinnedUrl;\n    }\n    if (pinnedUrlPath) {\n        const pinnedUrl = `${PIKA_CDN}${pinnedUrlPath}`;\n        await cacache.put(RESOURCE_CACHE, pinnedUrl, body, {\n            metadata: { pinnedUrl, typesUrl },\n        });\n        return pinnedUrl;\n    }\n    if (buildStatus === 'SUCCESS') {\n        console.warn(`Failed to lookup [${statusCode}]: ${installUrl}`);\n        console.warn(`Falling back to local copy...`);\n        return null;\n    }\n    if (!canRetry || buildStatus === 'FAIL') {\n        console.warn(`Failed to build: ${installSpecifier}@${packageSemver}`);\n        console.warn(`Falling back to local copy...`);\n        return null;\n    }\n    console.log(colors.cyan(`Building ${installSpecifier}@${packageSemver}... (This takes a moment, but will be cached for future use)`));\n    if (!importUrlPath) {\n        throw new Error('X-Import-URL header expected, but none received.');\n    }\n    const { statusCode: lookupStatusCode } = await fetchCDNResource(importUrlPath);\n    if (lookupStatusCode !== 200) {\n        throw new Error(`Unexpected response [${lookupStatusCode}]: ${PIKA_CDN}${importUrlPath}`);\n    }\n    return resolveDependency(installSpecifier, packageSemver, lockfile, false);\n}\nexport async function resolveTargetsFromRemoteCDN(lockfile, config) {\n    const downloadQueue = new PQueue({ concurrency: 16 });\n    const newLockfile = { imports: {} };\n    let resolutionError;\n    for (const [installSpecifier, installSemver] of Object.entries(config.webDependencies)) {\n        downloadQueue.add(async () => {\n            try {\n                const resolvedUrl = await resolveDependency(installSpecifier, installSemver, lockfile);\n                if (resolvedUrl) {\n                    newLockfile.imports[installSpecifier] = resolvedUrl;\n                }\n            }\n            catch (err) {\n                resolutionError = resolutionError || err;\n            }\n        });\n    }\n    await downloadQueue.onIdle();\n    if (resolutionError) {\n        throw resolutionError;\n    }\n    return newLockfile;\n}\n","import isNodeBuiltin from 'is-builtin-module';\n/**\n * rollup-plugin-catch-unresolved\n *\n * Catch any unresolved imports to give proper warnings (Rollup default is to ignore).\n */\nexport function rollupPluginCatchUnresolved() {\n    return {\n        name: 'snowpack:rollup-plugin-catch-unresolved',\n        resolveId(id, importer) {\n            // Ignore remote http/https imports\n            if (id.startsWith('http://') || id.startsWith('https://')) {\n                return false;\n            }\n            if (isNodeBuiltin(id)) {\n                this.warn({\n                    id: importer,\n                    message: `\"${id}\" (Node.js built-in) could not be resolved. (https://www.snowpack.dev/#node-built-in-could-not-be-resolved)`,\n                });\n            }\n            else {\n                this.warn({\n                    id: importer,\n                    message: `\"${id}\" could not be resolved. (Is it installed?)`,\n                });\n            }\n            return false;\n        },\n    };\n}\n","const FETCH_POLYFILL = `\n// native patch for: node-fetch, whatwg-fetch\n// ref: https://github.com/tc39/proposal-global\nvar getGlobal = function () {\n  if (typeof self !== 'undefined') { return self; }\n  if (typeof window !== 'undefined') { return window; }\n  if (typeof global !== 'undefined') { return global; }\n  throw new Error('unable to locate global object');\n}\nvar global = getGlobal();\nexport default global.fetch.bind(global);\nexport const Headers = global.Headers;\nexport const Request = global.Request;\nexport const Response = global.Response;\n`;\n/**\n * rollup-plugin-catch-fetch\n *\n * How it works: NPM packages will sometimes contain Node.js-specific polyfills\n * for the native browser Fetch API. Since this makes no sense in an ESM web\n * project, we can replace these expensive polyfills with native references to\n * the fetch API.\n *\n * This still allows you to polyfill fetch in older browsers, if you desire.\n */\nexport function rollupPluginCatchFetch() {\n    return {\n        name: 'snowpack:fetch-handler',\n        resolveId(id) {\n            if (id !== 'node-fetch' && id !== 'whatwg-fetch') {\n                return null;\n            }\n            return id;\n        },\n        load(id) {\n            if (id !== 'node-fetch' && id !== 'whatwg-fetch') {\n                return null;\n            }\n            return FETCH_POLYFILL;\n        },\n    };\n}\n","import { promises as fs } from 'fs';\nfunction getInjectorCode(name, code) {\n    return `\n/** SNOWPACK INJECT STYLE: ${name} */\nfunction __snowpack__injectStyle(css) {\n  const headEl = document.head || document.getElementsByTagName('head')[0];\n  const styleEl = document.createElement('style');\n  styleEl.type = 'text/css';\n  if (styleEl.styleSheet) {\n    styleEl.styleSheet.cssText = css;\n  } else {\n    styleEl.appendChild(document.createTextNode(css));\n  }\n  headEl.appendChild(styleEl);\n}\n__snowpack__injectStyle(${JSON.stringify(code)});\\n`;\n}\n/**\n * rollup-plugin-css\n *\n * Support installing any imported CSS into your dependencies. This isn't strictly valid\n * ESM code, but it is popular in the npm ecosystem & web development ecosystems. It also\n * solves a problem that is difficult to solve otherwise (referencing CSS from JS) so for\n * those reasons we have added default support for importing CSS into Snowpack v2.\n */\nexport function rollupPluginCss() {\n    return {\n        name: 'snowpack:rollup-plugin-css',\n        resolveId(source, importer) {\n            if (!source.endsWith('.css')) {\n                return null;\n            }\n            return this.resolve(source, importer, { skipSelf: true }).then((resolved) => {\n                return resolved || null;\n            });\n        },\n        async load(id) {\n            if (!id.endsWith('.css')) {\n                return null;\n            }\n            const code = await fs.readFile(id, { encoding: 'utf-8' });\n            const humanReadableName = id.replace(/.*node_modules[\\/\\\\]/, '').replace(/[\\/\\\\]/g, '/');\n            return getInjectorCode(humanReadableName, code);\n        },\n    };\n}\n","import fs from 'fs';\nimport cacache from 'cacache';\nimport mkdirp from 'mkdirp';\nimport path from 'path';\nimport tar from 'tar';\nimport url from 'url';\nimport { fetchCDNResource, HAS_CDN_HASH_REGEX, PIKA_CDN, RESOURCE_CACHE } from '../util';\nconst CACHED_FILE_ID_PREFIX = 'snowpack-pkg-cache:';\nconst PIKA_CDN_TRIM_LENGTH = PIKA_CDN.length;\n/**\n * rollup-plugin-remote-cdn\n *\n * Load import URLs from a remote CDN, sitting behind a local cache. The local\n * cache acts as a go-between for the resolve & load step: when we get back a\n * successful CDN resolution, we save the file to the local cache and then tell\n * rollup that it's safe to load from the cache in the `load()` hook.\n */\nexport function rollupPluginDependencyCache({ installTypes, log, }) {\n    const allTypesToInstall = new Set();\n    return {\n        name: 'snowpack:rollup-plugin-remote-cdn',\n        async resolveId(source, importer) {\n            let cacheKey;\n            if (source.startsWith(PIKA_CDN)) {\n                cacheKey = source;\n            }\n            else if (source.startsWith('/-/')) {\n                cacheKey = PIKA_CDN + source;\n            }\n            else if (source.startsWith('/pin/')) {\n                cacheKey = PIKA_CDN + source;\n            }\n            else {\n                return null;\n            }\n            // If the source path is a CDNÂ path including a hash, it's assumed the\n            // file will never change and it is safe to pull from our local cache\n            // without a network request.\n            log(cacheKey);\n            if (HAS_CDN_HASH_REGEX.test(cacheKey)) {\n                const cachedResult = await cacache.get\n                    .info(RESOURCE_CACHE, cacheKey)\n                    .catch(( /* ignore */) => null);\n                if (cachedResult) {\n                    return CACHED_FILE_ID_PREFIX + cacheKey;\n                }\n            }\n            // Otherwise, make the remote request and cache the file on success.\n            const response = await fetchCDNResource(cacheKey);\n            if (response.statusCode === 200) {\n                const typesUrlPath = response.headers['x-typescript-types'];\n                const pinnedUrlPath = response.headers['x-pinned-url'];\n                const typesUrl = typesUrlPath && `${PIKA_CDN}${typesUrlPath}`;\n                const pinnedUrl = pinnedUrlPath && `${PIKA_CDN}${pinnedUrlPath}`;\n                await cacache.put(RESOURCE_CACHE, cacheKey, response.body, {\n                    metadata: { pinnedUrl, typesUrl },\n                });\n                return CACHED_FILE_ID_PREFIX + cacheKey;\n            }\n            // If lookup failed, skip this plugin and resolve the import locallyÂ instead.\n            // TODO: Log that this has happened (if some sort of verbose mode is enabled).\n            const packageName = cacheKey\n                .substring(PIKA_CDN_TRIM_LENGTH)\n                .replace('/-/', '')\n                .replace('/pin/', '')\n                .split('@')[0];\n            return this.resolve(packageName, importer, { skipSelf: true }).then((resolved) => {\n                let finalResult = resolved;\n                if (!finalResult) {\n                    finalResult = { id: packageName };\n                }\n                return finalResult;\n            });\n        },\n        async load(id) {\n            if (!id.startsWith(CACHED_FILE_ID_PREFIX)) {\n                return null;\n            }\n            const cacheKey = id.substring(CACHED_FILE_ID_PREFIX.length);\n            log(cacheKey);\n            const cachedResult = await cacache.get(RESOURCE_CACHE, cacheKey);\n            const typesUrl = cachedResult.metadata?.typesUrl;\n            if (typesUrl && installTypes) {\n                const typesTarballUrl = typesUrl.replace(/(mode=types.*?)\\/.*/, '$1/all.tgz');\n                allTypesToInstall.add(typesTarballUrl);\n            }\n            return cachedResult.data.toString('utf-8');\n        },\n        async writeBundle(options) {\n            if (!installTypes) {\n                return;\n            }\n            await mkdirp(path.join(options.dir, '.types'));\n            const tempDir = await cacache.tmp.mkdir(RESOURCE_CACHE);\n            for (const typesTarballUrl of allTypesToInstall) {\n                let tarballContents;\n                const cachedTarball = await cacache\n                    .get(RESOURCE_CACHE, typesTarballUrl)\n                    .catch(( /* ignore */) => null);\n                if (cachedTarball) {\n                    tarballContents = cachedTarball.data;\n                }\n                else {\n                    const tarballResponse = await fetchCDNResource(typesTarballUrl, 'buffer');\n                    if (tarballResponse.statusCode !== 200) {\n                        continue;\n                    }\n                    tarballContents = tarballResponse.body;\n                    await cacache.put(RESOURCE_CACHE, typesTarballUrl, tarballContents);\n                }\n                const typesUrlParts = url.parse(typesTarballUrl).pathname.split('/');\n                const typesPackageName = url.parse(typesTarballUrl).pathname.startsWith('/-/@')\n                    ? typesUrlParts[2] + '/' + typesUrlParts[3].split('@')[0]\n                    : typesUrlParts[2].split('@')[0];\n                const typesPackageTarLoc = path.join(tempDir, `${typesPackageName}.tgz`);\n                if (typesPackageName.includes('/')) {\n                    await mkdirp(path.dirname(typesPackageTarLoc));\n                }\n                fs.writeFileSync(typesPackageTarLoc, tarballContents);\n                const typesPackageLoc = path.join(options.dir, `.types/${typesPackageName}`);\n                await mkdirp(typesPackageLoc);\n                await tar.x({\n                    file: typesPackageTarLoc,\n                    cwd: typesPackageLoc,\n                });\n            }\n        },\n    };\n}\n","import fs from 'fs';\nimport path from 'path';\nimport zlib from 'zlib';\nexport function rollupPluginDependencyStats(cb) {\n    let outputDir;\n    let existingFileCache = {};\n    let statsSummary = {\n        direct: {},\n        common: {},\n    };\n    function buildExistingFileCache(bundle) {\n        for (let fileName of Object.keys(bundle)) {\n            const filePath = path.join(outputDir, fileName);\n            if (fs.existsSync(filePath)) {\n                const { size } = fs.statSync(filePath);\n                existingFileCache[fileName] = size;\n            }\n        }\n    }\n    function compareDependencies(files, type) {\n        for (let { fileName, contents } of files) {\n            const size = contents.byteLength;\n            statsSummary[type][fileName] = {\n                size: size,\n                gzip: zlib.gzipSync(contents).byteLength,\n                brotli: zlib.brotliCompressSync ? zlib.brotliCompressSync(contents).byteLength : 0,\n            };\n            if (existingFileCache[fileName]) {\n                const delta = (size - existingFileCache[fileName]) / 1000;\n                statsSummary[type][fileName].delta = delta;\n            }\n        }\n    }\n    return {\n        name: 'snowpack:rollup-plugin-stats',\n        generateBundle(options, bundle) {\n            outputDir = options.dir;\n            buildExistingFileCache(bundle);\n        },\n        writeBundle(_, bundle) {\n            const directDependencies = [];\n            const commonDependencies = [];\n            for (const [fileName, assetOrChunk] of Object.entries(bundle)) {\n                const raw = assetOrChunk.type === 'asset' ? assetOrChunk.source : assetOrChunk.code;\n                const contents = Buffer.isBuffer(raw)\n                    ? raw\n                    : typeof raw === 'string'\n                        ? Buffer.from(raw, 'utf-8')\n                        : Buffer.from(raw);\n                if (fileName.startsWith('common')) {\n                    commonDependencies.push({ fileName, contents });\n                }\n                else {\n                    directDependencies.push({ fileName, contents });\n                }\n            }\n            compareDependencies(directDependencies, 'direct');\n            compareDependencies(commonDependencies, 'common');\n            cb(statsSummary);\n        },\n    };\n}\n","import * as colors from 'kleur/colors';\nimport path from 'path';\nfunction autoDetectExports(fileLoc) {\n    try {\n        return Object.keys(require(fileLoc));\n    }\n    catch (err) {\n        console.error(colors.red(`â Could not auto-detect exports for ${colors.bold(fileLoc)}\\n${err.message}`));\n    }\n}\n/**\n * rollup-plugin-wrap-install-targets\n *\n * How it works:\n * 1. An array of \"install targets\" are passed in, describing all known imports + metadata.\n * 2. If isTreeshake: Known imports are marked for tree-shaking by appending 'snowpack-wrap:' to the input value.\n * 3. If autoDetectPackageExports match: Also mark for wrapping, and use automatic export detection.\n * 4. On load, we return a false virtual file for all \"snowpack-wrap:\" inputs.\n *    a. That virtual file contains only `export ... from 'ACTUAL_FILE_PATH';` exports\n *    b. Rollup uses those exports to drive its tree-shaking algorithm.\n *    c. Rollup uses those exports to inform its \"namedExports\" for Common.js entrypoints.\n */\nexport function rollupPluginWrapInstallTargets(isTreeshake, autoDetectPackageExports, installTargets) {\n    const installTargetsByFile = {};\n    function isAutoDetect(normalizedFileLoc) {\n        return autoDetectPackageExports.some((p) => normalizedFileLoc.includes(`node_modules/${p}${p.endsWith('index.js') ? '' : '/'}`));\n    }\n    return {\n        name: 'snowpack:wrap-install-targets',\n        // Mark some inputs for tree-shaking.\n        options(inputOptions) {\n            const input = inputOptions.input;\n            for (const [key, val] of Object.entries(input)) {\n                installTargetsByFile[val] = installTargets.filter((imp) => imp.specifier === key);\n                if (isTreeshake &&\n                    installTargetsByFile[val].length > 0 &&\n                    !installTargetsByFile[val].some((imp) => imp.namespace || imp.all)) {\n                    input[key] = `snowpack-wrap:${val}`;\n                }\n                if (!isTreeshake) {\n                    const normalizedFileLoc = val.split(path.win32.sep).join(path.posix.sep);\n                    if (isAutoDetect(normalizedFileLoc)) {\n                        input[key] = `snowpack-wrap:${val}`;\n                    }\n                }\n            }\n            return inputOptions;\n        },\n        resolveId(source) {\n            if (source.startsWith('snowpack-wrap:')) {\n                return source;\n            }\n            return null;\n        },\n        load(id) {\n            if (!id.startsWith('snowpack-wrap:')) {\n                return null;\n            }\n            const fileLoc = id.substring('snowpack-wrap:'.length);\n            // Reduce all install targets into a single \"summarized\" install target.\n            const treeshakeSummary = installTargetsByFile[fileLoc].reduce((summary, imp) => {\n                summary.default = summary.default || imp.default;\n                summary.namespace = summary.namespace || imp.namespace;\n                summary.named = [...summary.named, ...imp.named];\n                return summary;\n            });\n            let uniqueNamedImports = Array.from(new Set(treeshakeSummary.named));\n            const normalizedFileLoc = fileLoc.split(path.win32.sep).join(path.posix.sep);\n            if (!isTreeshake && isAutoDetect(normalizedFileLoc)) {\n                uniqueNamedImports = autoDetectExports(fileLoc) || uniqueNamedImports;\n                treeshakeSummary.default = true;\n            }\n            const result = `\n        ${treeshakeSummary.namespace ? `export * from '${normalizedFileLoc}';` : ''}\n        ${treeshakeSummary.default\n                ? `import __pika_web_default_export_for_treeshaking__ from '${normalizedFileLoc}'; export default __pika_web_default_export_for_treeshaking__;`\n                : ''}\n        ${`export {${uniqueNamedImports.join(',')}} from '${normalizedFileLoc}';`}\n      `;\n            return result;\n        },\n    };\n}\n","import { init as initESModuleLexer, parse } from 'es-module-lexer';\nimport fs from 'fs';\nimport glob from 'glob';\nimport * as colors from 'kleur/colors';\nimport mime from 'mime-types';\nimport nodePath from 'path';\nimport stripComments from 'strip-comments';\nimport validatePackageName from 'validate-npm-package-name';\nimport { findMatchingAliasEntry, getExt, HTML_JS_REGEX, isTruthy } from './util';\nconst WEB_MODULES_TOKEN = 'web_modules/';\nconst WEB_MODULES_TOKEN_LENGTH = WEB_MODULES_TOKEN.length;\n// [@\\w] - Match a word-character or @ (valid package name)\n// (?!.*(:\\/\\/)) - Ignore if previous match was a protocol (ex: http://)\nconst BARE_SPECIFIER_REGEX = /^[@\\w](?!.*(:\\/\\/))/;\nconst ESM_IMPORT_REGEX = /import(?:[\"'\\s]*([\\w*${}\\n\\r\\t, ]+)\\s*from\\s*)?\\s*[\"'](.*?)[\"']/gm;\nconst ESM_DYNAMIC_IMPORT_REGEX = /import\\((?:['\"].+['\"]|`[^$]+`)\\)/gm;\nconst HAS_NAMED_IMPORTS_REGEX = /^[\\w\\s\\,]*\\{(.*)\\}/s;\nconst STRIP_AS = /\\s+as\\s+.*/; // for `import { foo as bar }`, strips âas barâ\nconst DEFAULT_IMPORT_REGEX = /import\\s+(\\w)+(,\\s\\{[\\w\\s]*\\})?\\s+from/s;\nfunction stripJsExtension(dep) {\n    return dep.replace(/\\.m?js$/i, '');\n}\nfunction createInstallTarget(specifier, all = true) {\n    return {\n        specifier,\n        all,\n        default: false,\n        namespace: false,\n        named: [],\n    };\n}\nfunction removeSpecifierQueryString(specifier) {\n    const queryStringIndex = specifier.indexOf('?');\n    if (queryStringIndex >= 0) {\n        specifier = specifier.substring(0, queryStringIndex);\n    }\n    return specifier;\n}\nfunction getWebModuleSpecifierFromCode(code, imp) {\n    // import.meta: we can ignore\n    if (imp.d === -2) {\n        return null;\n    }\n    // Static imports: easy to parse\n    if (imp.d === -1) {\n        return code.substring(imp.s, imp.e);\n    }\n    // Dynamic imports: a bit trickier to parse. Today, we only support string literals.\n    const importStatement = code.substring(imp.s, imp.e);\n    const importSpecifierMatch = importStatement.match(/^\\s*['\"](.*)['\"]\\s*$/m);\n    return importSpecifierMatch ? importSpecifierMatch[1] : null;\n}\n/**\n * parses an import specifier, looking for a web modules to install. If a web module is not detected,\n * null is returned.\n */\nfunction parseWebModuleSpecifier(specifier) {\n    if (!specifier) {\n        return null;\n    }\n    // If specifier is a \"bare module specifier\" (ie: package name) just return it directly\n    if (BARE_SPECIFIER_REGEX.test(specifier)) {\n        return specifier;\n    }\n    // Clean the specifier, remove any query params that may mess with matching\n    const cleanedSpecifier = removeSpecifierQueryString(specifier);\n    // Otherwise, check that it includes the \"web_modules/\" directory\n    const webModulesIndex = cleanedSpecifier.indexOf(WEB_MODULES_TOKEN);\n    if (webModulesIndex === -1) {\n        return null;\n    }\n    // Check if this matches `@scope/package.js` or `package.js` format.\n    // If it is, assume that this is a top-level pcakage that should be installed without the â.jsâ\n    const resolvedSpecifier = cleanedSpecifier.substring(webModulesIndex + WEB_MODULES_TOKEN_LENGTH);\n    const resolvedSpecifierWithoutExtension = stripJsExtension(resolvedSpecifier);\n    if (validatePackageName(resolvedSpecifierWithoutExtension).validForNewPackages) {\n        return resolvedSpecifierWithoutExtension;\n    }\n    // Otherwise, this is an explicit import to a file within a package.\n    return resolvedSpecifier;\n}\nfunction parseImportStatement(code, imp) {\n    const webModuleSpecifier = parseWebModuleSpecifier(getWebModuleSpecifierFromCode(code, imp));\n    if (!webModuleSpecifier) {\n        return null;\n    }\n    const importStatement = code.substring(imp.ss, imp.se);\n    if (/^import\\s+type/.test(importStatement)) {\n        return null;\n    }\n    const isDynamicImport = imp.d > -1;\n    const hasDefaultImport = !isDynamicImport && DEFAULT_IMPORT_REGEX.test(importStatement);\n    const hasNamespaceImport = !isDynamicImport && importStatement.includes('*');\n    const namedImports = (importStatement.match(HAS_NAMED_IMPORTS_REGEX) || [, ''])[1]\n        .split(',') // split `import { a, b, c }` by comma\n        .map((name) => name.replace(STRIP_AS, '').trim()) // remove â as â¦â and trim\n        .filter(isTruthy);\n    return {\n        specifier: webModuleSpecifier,\n        all: isDynamicImport || (!hasDefaultImport && !hasNamespaceImport && namedImports.length === 0),\n        default: hasDefaultImport,\n        namespace: hasNamespaceImport,\n        named: namedImports,\n    };\n}\nfunction cleanCodeForParsing(code) {\n    code = stripComments(code);\n    const allMatches = [];\n    let match;\n    const importRegex = new RegExp(ESM_IMPORT_REGEX);\n    while ((match = importRegex.exec(code))) {\n        allMatches.push(match);\n    }\n    const dynamicImportRegex = new RegExp(ESM_DYNAMIC_IMPORT_REGEX);\n    while ((match = dynamicImportRegex.exec(code))) {\n        allMatches.push(match);\n    }\n    return allMatches.map(([full]) => full).join('\\n');\n}\nfunction parseCodeForInstallTargets({ locOnDisk, baseExt, contents, }) {\n    let imports;\n    // Attempt #1: Parse the file as JavaScript. JSX and some decorator\n    // syntax will break this.\n    try {\n        if (baseExt === '.jsx' || baseExt === '.tsx') {\n            // We know ahead of time that this will almost certainly fail.\n            // Just jump right to the secondary attempt.\n            throw new Error('JSX must be cleaned before parsing');\n        }\n        [imports] = parse(contents) || [];\n    }\n    catch (err) {\n        // Attempt #2: Parse only the import statements themselves.\n        // This lets us guarentee we aren't sending any broken syntax to our parser,\n        // but at the expense of possible false +/- caused by our regex extractor.\n        try {\n            contents = cleanCodeForParsing(contents);\n            [imports] = parse(contents) || [];\n        }\n        catch (err) {\n            // Another error! No hope left, just abort.\n            console.error(colors.red(`! ${locOnDisk}`));\n            throw err;\n        }\n    }\n    const allImports = imports\n        .map((imp) => parseImportStatement(contents, imp))\n        .filter(isTruthy)\n        // Babel macros are not install targets!\n        .filter((imp) => !/[./]macro(\\.js)?$/.test(imp.specifier));\n    return allImports;\n}\nexport function scanDepList(depList, cwd) {\n    return depList\n        .map((whitelistItem) => {\n        if (!glob.hasMagic(whitelistItem)) {\n            return [createInstallTarget(whitelistItem, true)];\n        }\n        else {\n            const nodeModulesLoc = nodePath.join(cwd, 'node_modules');\n            return scanDepList(glob.sync(whitelistItem, { cwd: nodeModulesLoc, nodir: true }), cwd);\n        }\n    })\n        .reduce((flat, item) => flat.concat(item), []);\n}\nexport async function scanImports(cwd, config) {\n    await initESModuleLexer;\n    const includeFileSets = await Promise.all(Object.keys(config.mount).map((fromDisk) => {\n        const dirDisk = nodePath.resolve(cwd, fromDisk);\n        return glob.sync(`**/*`, {\n            ignore: config.exclude.concat(['**/web_modules/**/*']),\n            cwd: dirDisk,\n            absolute: true,\n            nodir: true,\n        });\n    }));\n    const includeFiles = Array.from(new Set([].concat.apply([], includeFileSets)));\n    if (includeFiles.length === 0) {\n        return [];\n    }\n    // Scan every matched JS file for web dependency imports\n    const loadedFiles = await Promise.all(includeFiles.map(async (filePath) => {\n        const { baseExt, expandedExt } = getExt(filePath);\n        // Always ignore dotfiles\n        if (filePath.startsWith('.')) {\n            return null;\n        }\n        switch (baseExt) {\n            // Probably a license, a README, etc\n            case '': {\n                return null;\n            }\n            // Our import scanner can handle normal JS & even TypeScript without a problem.\n            case '.js':\n            case '.jsx':\n            case '.mjs':\n            case '.ts':\n            case '.tsx': {\n                return {\n                    baseExt,\n                    expandedExt,\n                    locOnDisk: filePath,\n                    contents: await fs.promises.readFile(filePath, 'utf-8'),\n                };\n            }\n            case '.html':\n            case '.vue':\n            case '.svelte': {\n                const result = await fs.promises.readFile(filePath, 'utf-8');\n                // TODO: Replace with matchAll once Node v10 is out of TLS.\n                // const allMatches = [...result.matchAll(new RegExp(HTML_JS_REGEX))];\n                const allMatches = [];\n                let match;\n                const regex = new RegExp(HTML_JS_REGEX);\n                while ((match = regex.exec(result))) {\n                    allMatches.push(match);\n                }\n                return {\n                    baseExt,\n                    expandedExt,\n                    locOnDisk: filePath,\n                    // match[2] is the code inside the <script></script> element\n                    contents: allMatches\n                        .map((match) => match[2])\n                        .filter((s) => s.trim())\n                        .join('\\n'),\n                };\n            }\n        }\n        // If we don't recognize the file type, it could be source. Warn just in case.\n        if (!mime.lookup(baseExt)) {\n            console.warn(colors.dim(`ignoring unsupported file \"${nodePath.relative(process.cwd(), filePath)}\"`));\n        }\n        return null;\n    }));\n    return scanImportsFromFiles(loadedFiles.filter(isTruthy), config);\n}\nexport async function scanImportsFromFiles(loadedFiles, config) {\n    return loadedFiles\n        .map(parseCodeForInstallTargets)\n        .reduce((flat, item) => flat.concat(item), [])\n        .filter((target) => {\n        const aliasEntry = findMatchingAliasEntry(config, target.specifier);\n        return !aliasEntry || aliasEntry.type === 'package';\n    })\n        .sort((impA, impB) => impA.specifier.localeCompare(impB.specifier));\n}\n","import * as colors from 'kleur/colors';\n/** The minimum width, in characters, of each size column */\nconst SIZE_COLUMN_WIDTH = 11;\n/** Generic Object.entries() alphabetical sort by keys. */\nfunction entriesSort([filenameA], [filenameB]) {\n    return filenameA.localeCompare(filenameB);\n}\n/** Pretty-prints number of bytes as \"XXX KB\" */\nfunction formatSize(size) {\n    let kb = Math.round((size / 1000) * 100) / 100;\n    if (kb >= 1000) {\n        kb = Math.floor(kb);\n    }\n    let color;\n    if (kb < 15) {\n        color = 'green';\n    }\n    else if (kb < 30) {\n        color = 'yellow';\n    }\n    else {\n        color = 'red';\n    }\n    return colors[color](`${kb} KB`.padEnd(SIZE_COLUMN_WIDTH));\n}\nfunction formatDelta(delta) {\n    const kb = Math.round(delta * 100) / 100;\n    const color = delta > 0 ? 'red' : 'green';\n    return colors[color](`Î ${delta > 0 ? '+' : ''}${kb} KB`);\n}\nfunction formatFileInfo(filename, stats, padEnd, isLastFile) {\n    const lineGlyph = colors.dim(isLastFile ? 'ââ' : 'ââ');\n    const lineName = filename.padEnd(padEnd);\n    const fileStat = formatSize(stats.size);\n    const gzipStat = formatSize(stats.gzip);\n    const brotliStat = formatSize(stats.brotli);\n    const lineStat = fileStat + gzipStat + brotliStat;\n    let lineDelta = '';\n    if (stats.delta) {\n        lineDelta = colors.dim('[') + formatDelta(stats.delta) + colors.dim(']');\n    }\n    // Trim trailing whitespace (can mess with formatting), but keep indentation.\n    return `    ` + `${lineGlyph} ${lineName} ${lineStat} ${lineDelta}`.trim();\n}\nfunction formatFiles(files, padEnd) {\n    const strippedFiles = files.map(([filename, stats]) => [\n        filename.replace(/^common\\//, ''),\n        stats,\n    ]);\n    return strippedFiles\n        .map(([filename, stats], index) => formatFileInfo(filename, stats, padEnd, index >= files.length - 1))\n        .join('\\n');\n}\nexport function printStats(dependencyStats) {\n    let output = '';\n    const { direct, common } = dependencyStats;\n    const allDirect = Object.entries(direct).sort(entriesSort);\n    const allCommon = Object.entries(common).sort(entriesSort);\n    const maxFileNameLength = [...allCommon, ...allDirect].reduce((max, [filename]) => Math.max(filename.length, max), 'web_modules/'.length) + 1;\n    output +=\n        `  â¦¿ ${colors.bold('web_modules/'.padEnd(maxFileNameLength + 4))}` +\n            colors.bold(colors.underline('size'.padEnd(SIZE_COLUMN_WIDTH - 2))) +\n            '  ' +\n            colors.bold(colors.underline('gzip'.padEnd(SIZE_COLUMN_WIDTH - 2))) +\n            '  ' +\n            colors.bold(colors.underline('brotli'.padEnd(SIZE_COLUMN_WIDTH - 2))) +\n            `\\n`;\n    output += `${formatFiles(allDirect, maxFileNameLength)}\\n`;\n    if (Object.values(common).length > 0) {\n        output += `  â¦¿ ${colors.bold('web_modules/common/ (Shared)')}\\n`;\n        output += `${formatFiles(allCommon, maxFileNameLength)}\\n`;\n    }\n    return `\\n${output}\\n`;\n}\n","import rollupPluginAlias from '@rollup/plugin-alias';\nimport rollupPluginCommonjs from '@rollup/plugin-commonjs';\nimport rollupPluginJson from '@rollup/plugin-json';\nimport rollupPluginNodeResolve from '@rollup/plugin-node-resolve';\nimport rollupPluginReplace from '@rollup/plugin-replace';\nimport { init as initESModuleLexer } from 'es-module-lexer';\nimport findUp from 'find-up';\nimport fs from 'fs';\nimport * as colors from 'kleur/colors';\nimport mkdirp from 'mkdirp';\nimport ora from 'ora';\nimport path from 'path';\nimport { performance } from 'perf_hooks';\nimport rimraf from 'rimraf';\nimport { rollup } from 'rollup';\nimport validatePackageName from 'validate-npm-package-name';\nimport { resolveTargetsFromRemoteCDN } from '../resolve-remote.js';\nimport { rollupPluginCatchUnresolved } from '../rollup-plugins/rollup-plugin-catch-unresolved.js';\nimport { rollupPluginCatchFetch } from '../rollup-plugins/rollup-plugin-catch-fetch';\nimport { rollupPluginCss } from '../rollup-plugins/rollup-plugin-css';\nimport { rollupPluginDependencyCache } from '../rollup-plugins/rollup-plugin-remote-cdn.js';\nimport { rollupPluginDependencyStats } from '../rollup-plugins/rollup-plugin-stats.js';\nimport { rollupPluginWrapInstallTargets } from '../rollup-plugins/rollup-plugin-wrap-install-targets';\nimport { scanDepList, scanImports, scanImportsFromFiles } from '../scan-imports.js';\nimport { printStats } from '../stats-formatter.js';\nimport { isTruthy, MISSING_PLUGIN_SUGGESTIONS, parsePackageImportSpecifier, resolveDependencyManifest, sanitizePackageName, writeLockfile, isPackageAliasEntry, findMatchingAliasEntry, } from '../util.js';\nclass ErrorWithHint extends Error {\n    constructor(message, hint) {\n        super(message);\n        this.hint = hint;\n    }\n}\n// Add popular CJS packages here that use \"synthetic\" named imports in their documentation.\n// CJS packages should really only be imported via the default export:\n//   import React from 'react';\n// But, some large projects use named exports in their documentation:\n//   import {useState} from 'react';\n//\n// We use \"/index.js here to match the official package, but not any ESM aliase packages\n// that the user may have installed instead (ex: react-esm).\nconst CJS_PACKAGES_TO_AUTO_DETECT = [\n    'react/index.js',\n    'react-dom/index.js',\n    'react-dom/server.js',\n    'react-is/index.js',\n    'prop-types/index.js',\n    'scheduler/index.js',\n    'react-table',\n];\nconst cwd = process.cwd();\nconst banner = colors.bold(`snowpack`) + ` installing... `;\nlet spinner;\nlet spinnerHasError = false;\nlet installResults = [];\nlet dependencyStats = null;\nfunction defaultLogError(msg) {\n    if (spinner && !spinnerHasError) {\n        spinner.stopAndPersist({ symbol: colors.cyan('â ¼') });\n    }\n    spinnerHasError = true;\n    spinner = ora(colors.red(msg));\n    spinner.fail();\n}\nfunction defaultLogUpdate(msg) {\n    spinner.text = banner + msg;\n}\nfunction formatInstallResults() {\n    return installResults\n        .map(([d, result]) => {\n        if (result === 'SUCCESS') {\n            return colors.green(d);\n        }\n        if (result === 'ASSET') {\n            return colors.yellow(d);\n        }\n        if (result === 'FAIL') {\n            return colors.red(d);\n        }\n        return d;\n    })\n        .join(', ');\n}\nfunction isImportOfPackage(importUrl, packageName) {\n    return packageName === importUrl || importUrl.startsWith(packageName + '/');\n}\n/**\n * Formats the snowpack dependency name from a \"webDependencies\" input value:\n * 2. Remove any \".js\"/\".mjs\" extension (will be added automatically by Rollup)\n */\nfunction getWebDependencyName(dep) {\n    return validatePackageName(dep).validForNewPackages\n        ? dep.replace(/\\.js$/i, 'js') // if this is a top-level package ending in .js, replace with js (e.g. tippy.js -> tippyjs)\n        : dep.replace(/\\.m?js$/i, ''); // otherwise simply strip the extension (Rollup will resolve it)\n}\n/**\n * Takes object of env var mappings and converts it to actual\n * replacement specs as expected by @rollup/plugin-replace. The\n * `optimize` arg is used to derive NODE_ENV default.\n *\n * @param env\n * @param optimize\n */\nfunction getRollupReplaceKeys(env) {\n    const result = Object.keys(env).reduce((acc, id) => {\n        const val = env[id];\n        acc[`process.env.${id}`] = `${JSON.stringify(val === true ? process.env[id] : val)}`;\n        return acc;\n    }, {\n        'process.env.NODE_ENV': JSON.stringify(process.env.NODE_ENV || 'production'),\n        'process.versions.node': 'undefined',\n        'process.platform': JSON.stringify('browser'),\n        'process.env.': '({}).',\n        'typeof process.versions.node': JSON.stringify('undefined'),\n        'typeof process.versions': JSON.stringify('undefined'),\n        'typeof process': JSON.stringify('undefined'),\n    });\n    return result;\n}\n/**\n * Resolve a \"webDependencies\" input value to the correct absolute file location.\n * Supports both npm package names, and file paths relative to the node_modules directory.\n * Follows logic similar to Node's resolution logic, but using a package.json's ESM \"module\"\n * field instead of the CJS \"main\" field.\n */\nfunction resolveWebDependency(dep) {\n    // if dep points directly to a file within a package, return that reference.\n    // No other lookup required.\n    if (path.extname(dep) && !validatePackageName(dep).validForNewPackages) {\n        const isJSFile = ['.js', '.mjs', '.cjs'].includes(path.extname(dep));\n        return {\n            type: isJSFile ? 'JS' : 'ASSET',\n            loc: require.resolve(dep, { paths: [cwd] }),\n        };\n    }\n    // If dep is a path within a package (but without an extension), we first need\n    // to check for an export map in the package.json. If one exists, resolve to it.\n    const [packageName, packageEntrypoint] = parsePackageImportSpecifier(dep);\n    if (packageEntrypoint) {\n        const [packageManifestLoc, packageManifest] = resolveDependencyManifest(packageName, cwd);\n        if (packageManifestLoc && packageManifest && packageManifest.exports) {\n            const exportMapEntry = packageManifest.exports['./' + packageEntrypoint];\n            const exportMapValue = exportMapEntry?.browser ||\n                exportMapEntry?.import ||\n                exportMapEntry?.default ||\n                exportMapEntry?.require ||\n                exportMapEntry;\n            if (typeof exportMapValue !== 'string') {\n                throw new Error(`Package \"${packageName}\" exists but package.json \"exports\" does not include entry for \"./${packageEntrypoint}\".`);\n            }\n            return {\n                type: 'JS',\n                loc: path.join(packageManifestLoc, '..', exportMapValue),\n            };\n        }\n    }\n    // Otherwise, resolve directly to the dep specifier. Note that this supports both\n    // \"package-name\" & \"package-name/some/path\" where \"package-name/some/path/package.json\"\n    // exists at that lower path, that must be used to resolve. In that case, export\n    // maps should not be supported.\n    const [depManifestLoc, depManifest] = resolveDependencyManifest(dep, cwd);\n    if (!depManifest) {\n        try {\n            const maybeLoc = require.resolve(dep, { paths: [cwd] });\n            return {\n                type: 'JS',\n                loc: maybeLoc,\n            };\n        }\n        catch (err) {\n            // Oh well, was worth a try\n        }\n    }\n    if (!depManifestLoc || !depManifest) {\n        throw new ErrorWithHint(`Package \"${dep}\" not found. Have you installed it?`, depManifestLoc ? colors.italic(depManifestLoc) : '');\n    }\n    if (depManifest.name &&\n        (depManifest.name.startsWith('@reactesm') || depManifest.name.startsWith('@pika/react'))) {\n        throw new Error(`React workaround packages no longer needed! Revert back to the official React & React-DOM packages.`);\n    }\n    let foundEntrypoint = depManifest['browser:module'] ||\n        depManifest.module ||\n        depManifest['main:esnext'] ||\n        depManifest.browser;\n    // Some packages define \"browser\" as an object. We'll do our best to find the\n    // right entrypoint in an entrypoint object, or fail otherwise.\n    // See: https://github.com/defunctzombie/package-browser-field-spec\n    if (typeof foundEntrypoint === 'object') {\n        foundEntrypoint =\n            foundEntrypoint[dep] ||\n                foundEntrypoint['./index.js'] ||\n                foundEntrypoint['./index'] ||\n                foundEntrypoint['./'] ||\n                foundEntrypoint['.'];\n    }\n    // If browser object is set but no relevant entrypoint is found, fall back to \"main\".\n    if (!foundEntrypoint) {\n        foundEntrypoint = depManifest.main;\n    }\n    // Sometimes packages don't give an entrypoint, assuming you'll fall back to \"index.js\".\n    const isImplicitEntrypoint = !foundEntrypoint;\n    if (isImplicitEntrypoint) {\n        foundEntrypoint = 'index.js';\n    }\n    if (typeof foundEntrypoint !== 'string') {\n        throw new Error(`\"${dep}\" has unexpected entrypoint: ${JSON.stringify(foundEntrypoint)}.`);\n    }\n    try {\n        return {\n            type: 'JS',\n            loc: require.resolve(path.join(depManifestLoc || '', '..', foundEntrypoint)),\n        };\n    }\n    catch (err) {\n        // Type only packages! Some packages are purely for TypeScript (ex: csstypes).\n        // If no JS entrypoint was given or found, but a TS \"types\"/\"typings\" entrypoint\n        // was given, assume a TS-types only package and ignore.\n        if (isImplicitEntrypoint && (depManifest.types || depManifest.typings)) {\n            return { type: 'IGNORE', loc: '' };\n        }\n        // Otherwise, file truly doesn't exist.\n        throw err;\n    }\n}\nconst FAILED_INSTALL_RETURN = {\n    success: false,\n    importMap: null,\n};\nexport async function install(installTargets, { lockfile, logError, logUpdate }, config) {\n    const { webDependencies, alias: installAlias, installOptions: { installTypes, dest: destLoc, externalPackage: externalPackages, sourceMap, env, rollup: userDefinedRollup, treeshake: isTreeshake, }, } = config;\n    const nodeModulesInstalled = findUp.sync('node_modules', { cwd, type: 'directory' });\n    if (!webDependencies && !process.versions.pnp && !nodeModulesInstalled) {\n        logError('no \"node_modules\" directory exists. Did you run \"npm install\" first?');\n        return FAILED_INSTALL_RETURN;\n    }\n    const allInstallSpecifiers = new Set(installTargets\n        .filter((dep) => !externalPackages.some((packageName) => isImportOfPackage(dep.specifier, packageName)))\n        .map((dep) => dep.specifier)\n        .map((specifier) => {\n        const aliasEntry = findMatchingAliasEntry(config, specifier);\n        return aliasEntry && aliasEntry.type === 'package' ? aliasEntry.to : specifier;\n    })\n        .sort());\n    const installEntrypoints = {};\n    const assetEntrypoints = {};\n    const importMap = { imports: {} };\n    const installTargetsMap = {};\n    const skipFailures = false;\n    const autoDetectNamedExports = [\n        ...CJS_PACKAGES_TO_AUTO_DETECT,\n        ...config.installOptions.namedExports,\n    ];\n    for (const installSpecifier of allInstallSpecifiers) {\n        const targetName = getWebDependencyName(installSpecifier);\n        const proxiedName = sanitizePackageName(targetName); // sometimes we need to sanitize webModule names, as in the case of tippy.js -> tippyjs\n        if (lockfile && lockfile.imports[installSpecifier]) {\n            installEntrypoints[targetName] = lockfile.imports[installSpecifier];\n            importMap.imports[installSpecifier] = `./${proxiedName}.js`;\n            installResults.push([targetName, 'SUCCESS']);\n            logUpdate(formatInstallResults());\n            continue;\n        }\n        try {\n            const { type: targetType, loc: targetLoc } = resolveWebDependency(installSpecifier);\n            if (targetType === 'JS') {\n                installEntrypoints[targetName] = targetLoc;\n                importMap.imports[installSpecifier] = `./${proxiedName}.js`;\n                Object.entries(installAlias)\n                    .filter(([, value]) => value === installSpecifier)\n                    .forEach(([key]) => {\n                    importMap.imports[key] = `./${targetName}.js`;\n                });\n                installTargetsMap[targetLoc] = installTargets.filter((t) => installSpecifier === t.specifier);\n                installResults.push([installSpecifier, 'SUCCESS']);\n            }\n            else if (targetType === 'ASSET') {\n                assetEntrypoints[targetName] = targetLoc;\n                importMap.imports[installSpecifier] = `./${proxiedName}`;\n                installResults.push([installSpecifier, 'ASSET']);\n            }\n            logUpdate(formatInstallResults());\n        }\n        catch (err) {\n            installResults.push([installSpecifier, 'FAIL']);\n            logUpdate(formatInstallResults());\n            if (skipFailures) {\n                continue;\n            }\n            // An error occurred! Log it.\n            logError(err.message || err);\n            if (err.hint) {\n                // Note: Wait 1ms to guarantee a log message after the spinner\n                setTimeout(() => console.log(err.hint), 1);\n            }\n            return FAILED_INSTALL_RETURN;\n        }\n    }\n    if (Object.keys(installEntrypoints).length === 0 && Object.keys(assetEntrypoints).length === 0) {\n        logError(`No ESM dependencies found!`);\n        console.log(colors.dim(`  At least one dependency must have an ESM \"module\" entrypoint. You can find modern, web-ready packages at ${colors.underline('https://www.pika.dev')}`));\n        return FAILED_INSTALL_RETURN;\n    }\n    await initESModuleLexer;\n    let isCircularImportFound = false;\n    const inputOptions = {\n        input: installEntrypoints,\n        external: (id) => externalPackages.some((packageName) => isImportOfPackage(id, packageName)),\n        treeshake: { moduleSideEffects: 'no-external' },\n        plugins: [\n            rollupPluginReplace(getRollupReplaceKeys(env)),\n            !!webDependencies &&\n                rollupPluginDependencyCache({\n                    installTypes,\n                    log: (url) => logUpdate(colors.dim(url)),\n                }),\n            rollupPluginAlias({\n                entries: Object.entries(installAlias)\n                    .filter(([, val]) => isPackageAliasEntry(val))\n                    .map(([key, val]) => ({\n                    find: key,\n                    replacement: val,\n                })),\n            }),\n            rollupPluginCatchFetch(),\n            rollupPluginNodeResolve({\n                mainFields: ['browser:module', 'module', 'browser', 'main'].filter(isTruthy),\n                extensions: ['.mjs', '.cjs', '.js', '.json'],\n                // whether to prefer built-in modules (e.g. `fs`, `path`) or local ones with the same names\n                preferBuiltins: true,\n                dedupe: userDefinedRollup.dedupe,\n            }),\n            rollupPluginJson({\n                preferConst: true,\n                indent: '  ',\n                compact: false,\n                namedExports: true,\n            }),\n            rollupPluginCss(),\n            rollupPluginCommonjs({\n                extensions: ['.js', '.cjs'],\n                // Workaround: CJS -> ESM isn't supported yet by the plugin, so we needed\n                // to add our own custom workaround here. Requires a fork of\n                // rollupPluginCommonjs that supports the \"externalEsm\" option.\n                externalEsm: process.env.EXTERNAL_ESM_PACKAGES || [],\n            }),\n            rollupPluginWrapInstallTargets(!!isTreeshake, autoDetectNamedExports, installTargets),\n            rollupPluginDependencyStats((info) => (dependencyStats = info)),\n            ...userDefinedRollup.plugins,\n            rollupPluginCatchUnresolved(),\n        ].filter(Boolean),\n        onwarn(warning, warn) {\n            // Warn about the first circular dependency, but then ignore the rest.\n            if (warning.code === 'CIRCULAR_DEPENDENCY') {\n                if (!isCircularImportFound) {\n                    isCircularImportFound = true;\n                    logUpdate(`Warning: 1+ circular dependencies found via \"${warning.importer}\".`);\n                }\n                return;\n            }\n            // Log \"unresolved\" import warnings as an error, causing Snowpack to fail at the end.\n            if (warning.code === 'PLUGIN_WARNING' &&\n                warning.plugin === 'snowpack:rollup-plugin-catch-unresolved') {\n                // Display posix-style on all environments, mainly to help with CI :)\n                if (warning.id) {\n                    const fileName = path.relative(cwd, warning.id).replace(/\\\\/g, '/');\n                    logError(`${fileName}\\n   ${warning.message}`);\n                }\n                else {\n                    logError(`${warning.message}. See https://www.snowpack.dev/#troubleshooting`);\n                }\n                return;\n            }\n            warn(warning);\n        },\n    };\n    const outputOptions = {\n        dir: destLoc,\n        format: 'esm',\n        sourcemap: sourceMap,\n        exports: 'named',\n        chunkFileNames: 'common/[name]-[hash].js',\n    };\n    if (Object.keys(installEntrypoints).length > 0) {\n        try {\n            const packageBundle = await rollup(inputOptions);\n            logUpdate(formatInstallResults());\n            await packageBundle.write(outputOptions);\n        }\n        catch (_err) {\n            const err = _err;\n            const errFilePath = err.loc?.file || err.id;\n            if (!errFilePath) {\n                throw err;\n            }\n            // NOTE: Rollup will fail instantly on most errors. Therefore, we can\n            // only report one error at a time. `err.watchFiles` also exists, but\n            // for now `err.loc.file` and `err.id` have all the info that we need.\n            const failedExtension = path.extname(errFilePath);\n            const suggestion = MISSING_PLUGIN_SUGGESTIONS[failedExtension] || err.message;\n            // Display posix-style on all environments, mainly to help with CI :)\n            const fileName = path.relative(cwd, errFilePath).replace(/\\\\/g, '/');\n            logError(`${colors.bold('snowpack')} failed to load ${colors.bold(fileName)}\\n  ${suggestion}`);\n            return FAILED_INSTALL_RETURN;\n        }\n    }\n    await writeLockfile(path.join(destLoc, 'import-map.json'), importMap);\n    for (const [assetName, assetLoc] of Object.entries(assetEntrypoints)) {\n        const assetDest = `${destLoc}/${sanitizePackageName(assetName)}`;\n        mkdirp.sync(path.dirname(assetDest));\n        fs.copyFileSync(assetLoc, assetDest);\n    }\n    return { success: true, importMap };\n}\nexport async function getInstallTargets(config, scannedFiles) {\n    const { knownEntrypoints, webDependencies } = config;\n    const installTargets = [];\n    if (knownEntrypoints) {\n        installTargets.push(...scanDepList(knownEntrypoints, cwd));\n    }\n    if (webDependencies) {\n        installTargets.push(...scanDepList(Object.keys(webDependencies), cwd));\n    }\n    if (scannedFiles) {\n        installTargets.push(...(await scanImportsFromFiles(scannedFiles, config)));\n    }\n    else {\n        installTargets.push(...(await scanImports(cwd, config)));\n    }\n    return installTargets;\n}\nexport async function command(commandOptions) {\n    const { cwd, config } = commandOptions;\n    const installTargets = await getInstallTargets(config);\n    if (installTargets.length === 0) {\n        defaultLogError('Nothing to install.');\n        return;\n    }\n    const finalResult = await run({ ...commandOptions, installTargets });\n    if (finalResult.newLockfile) {\n        await writeLockfile(path.join(cwd, 'snowpack.lock.json'), finalResult.newLockfile);\n    }\n    if (finalResult.stats) {\n        console.log(printStats(finalResult.stats));\n    }\n    if (!finalResult.success || finalResult.hasError) {\n        process.exit(1);\n    }\n}\nexport async function run({ config, lockfile, installTargets, }) {\n    const { installOptions: { dest }, webDependencies, } = config;\n    installResults = [];\n    dependencyStats = null;\n    spinner = ora(banner);\n    spinnerHasError = false;\n    if (installTargets.length === 0) {\n        return {\n            success: true,\n            hasError: false,\n            importMap: { imports: {} },\n            newLockfile: null,\n            stats: null,\n        };\n    }\n    let newLockfile = null;\n    if (webDependencies && Object.keys(webDependencies).length > 0) {\n        newLockfile = await resolveTargetsFromRemoteCDN(lockfile, config).catch((err) => {\n            defaultLogError(err.message || err);\n            process.exit(1);\n        });\n    }\n    rimraf.sync(dest);\n    const installStart = performance.now();\n    const finalResult = await install(installTargets, {\n        lockfile: newLockfile,\n        logError: defaultLogError,\n        logUpdate: defaultLogUpdate,\n    }, config).catch((err) => {\n        if (err.loc) {\n            console.log('\\n' + colors.red(colors.bold(`â ${err.loc.file}`)));\n        }\n        if (err.url) {\n            console.log(colors.dim(`ð ${err.url}`));\n        }\n        spinner.stop();\n        throw err;\n    });\n    if (finalResult.success) {\n        const installEnd = performance.now();\n        spinner.succeed(colors.bold(`snowpack`) +\n            ` install complete${spinnerHasError ? ' with errors.' : '.'}` +\n            colors.dim(` [${((installEnd - installStart) / 1000).toFixed(2)}s]`));\n    }\n    else {\n        spinner.stop();\n    }\n    return {\n        success: finalResult.success,\n        hasError: spinnerHasError,\n        importMap: finalResult.importMap,\n        newLockfile,\n        stats: dependencyStats,\n    };\n}\n","import { promises as fs } from 'fs';\nimport got from 'got';\nimport path from 'path';\nimport { command as installCommand } from './install';\nexport async function addCommand(addValue, commandOptions) {\n    const { cwd, config, pkgManifest } = commandOptions;\n    let [pkgName, pkgSemver] = addValue.split('@');\n    if (!pkgSemver) {\n        const body = (await got(`http://registry.npmjs.org/${pkgName}/latest`).json());\n        pkgSemver = `^${body.version}`;\n    }\n    pkgManifest.webDependencies = pkgManifest.webDependencies || {};\n    pkgManifest.webDependencies[pkgName] = pkgSemver;\n    config.webDependencies = config.webDependencies || {};\n    config.webDependencies[pkgName] = pkgSemver;\n    await fs.writeFile(path.join(cwd, 'package.json'), JSON.stringify(pkgManifest, null, 2));\n    await installCommand(commandOptions);\n}\nexport async function rmCommand(addValue, commandOptions) {\n    const { cwd, config, pkgManifest } = commandOptions;\n    let [pkgName] = addValue.split('@');\n    pkgManifest.webDependencies = pkgManifest.webDependencies || {};\n    delete pkgManifest.webDependencies[pkgName];\n    config.webDependencies = config.webDependencies || {};\n    delete config.webDependencies[pkgName];\n    await fs.writeFile(path.join(cwd, 'package.json'), JSON.stringify(pkgManifest, null, 2));\n    await installCommand(commandOptions);\n}\n","import path from 'path';\nimport { getExt, URL_HAS_PROTOCOL_REGEX } from '../util';\nexport function getMetaUrlPath(urlPath, isDev, config) {\n    let { baseUrl, metaDir } = config.buildOptions || {};\n    if (isDev) {\n        return path.posix.normalize(path.posix.join('/', metaDir, urlPath));\n    }\n    if (URL_HAS_PROTOCOL_REGEX.test(baseUrl)) {\n        return baseUrl + path.posix.normalize(path.posix.join(metaDir, urlPath));\n    }\n    return path.posix.normalize(path.posix.join(baseUrl, metaDir, urlPath));\n}\nexport function wrapImportMeta({ code, hmr, env, isDev, config, }) {\n    if (!code.includes('import.meta')) {\n        return code;\n    }\n    return ((hmr\n        ? `import * as  __SNOWPACK_HMR__ from '${getMetaUrlPath('hmr.js', isDev, config)}';\\nimport.meta.hot = __SNOWPACK_HMR__.createHotContext(import.meta.url);\\n`\n        : ``) +\n        (env\n            ? `import __SNOWPACK_ENV__ from '${getMetaUrlPath('env.js', isDev, config)}';\\nimport.meta.env = __SNOWPACK_ENV__;\\n`\n            : ``) +\n        '\\n' +\n        code);\n}\nexport function wrapHtmlResponse({ code, isDev, hmr, config, }) {\n    // replace %PUBLIC_URL% in HTML files (along with surrounding slashes, if any)\n    code = code.replace(/\\/?%PUBLIC_URL%\\/?/g, config.buildOptions.baseUrl);\n    if (hmr) {\n        code += `<script type=\"module\" src=\"${getMetaUrlPath('hmr.js', isDev, config)}\"></script>`;\n    }\n    return code;\n}\nfunction generateJsonImportProxy({ code, hmr, isDev, config, }) {\n    const jsonImportProxyCode = `${hmr ? `import.meta.hot.accept(({module}) => { json = module.default; });` : ''}\nlet json = ${JSON.stringify(JSON.parse(code))};\nexport default json;`;\n    return wrapImportMeta({ code: jsonImportProxyCode, hmr, env: false, isDev, config });\n}\nfunction generateCssImportProxy({ code, hmr, isDev, config, }) {\n    const cssImportProxyCode = `${hmr\n        ? `\nimport.meta.hot.accept();\nimport.meta.hot.dispose(() => {\ndocument.head.removeChild(styleEl);\n});\\n`\n        : ''}\nconst code = ${JSON.stringify(code)};\n\nconst styleEl = document.createElement(\"style\");\nconst codeEl = document.createTextNode(code);\nstyleEl.type = 'text/css';\n\nstyleEl.appendChild(codeEl);\ndocument.head.appendChild(styleEl);`;\n    return wrapImportMeta({ code: cssImportProxyCode, hmr, env: false, isDev, config });\n}\nlet _cssModuleLoader;\nasync function generateCssModuleImportProxy({ url, code, isDev, hmr, config, }) {\n    _cssModuleLoader = _cssModuleLoader || new (require('css-modules-loader-core'))();\n    const { injectableSource, exportTokens } = await _cssModuleLoader.load(code, url, undefined, () => {\n        throw new Error('Imports in CSS Modules are not yet supported.');\n    });\n    return `${hmr\n        ? `\nimport * as __SNOWPACK_HMR_API__ from '${getMetaUrlPath('hmr.js', isDev, config)}';\nimport.meta.hot = __SNOWPACK_HMR_API__.createHotContext(import.meta.url);\nimport.meta.hot.accept(({module}) => {\n  code = module.code;\n  json = module.default;\n});\nimport.meta.hot.dispose(() => {\n  document.head.removeChild(styleEl);\n});\\n`\n        : ``}\nexport let code = ${JSON.stringify(injectableSource)};\nlet json = ${JSON.stringify(exportTokens)};\nexport default json;\n\nconst styleEl = document.createElement(\"style\");\nconst codeEl = document.createTextNode(code);\nstyleEl.type = 'text/css';\n\nstyleEl.appendChild(codeEl);\ndocument.head.appendChild(styleEl);`;\n}\nfunction generateDefaultImportProxy(url) {\n    return `export default ${JSON.stringify(url)};`;\n}\nexport async function wrapImportProxy({ url, code, isDev, hmr, config, }) {\n    const { baseExt, expandedExt } = getExt(url);\n    if (baseExt === '.json') {\n        return generateJsonImportProxy({ code, hmr, isDev, config });\n    }\n    if (expandedExt.endsWith('.module.css')) {\n        return await generateCssModuleImportProxy({\n            url,\n            code,\n            isDev,\n            hmr,\n            config,\n        });\n    }\n    if (baseExt === '.css') {\n        return generateCssImportProxy({ code, hmr, isDev, config });\n    }\n    return generateDefaultImportProxy(url);\n}\nconst PUBLIC_ENV_REGEX = /^SNOWPACK_PUBLIC_/;\nexport function generateEnvModule(mode) {\n    const envObject = { ...process.env };\n    for (const env of Object.keys(envObject)) {\n        if (!PUBLIC_ENV_REGEX.test(env)) {\n            delete envObject[env];\n        }\n    }\n    envObject.MODE = mode;\n    envObject.NODE_ENV = mode;\n    return `export default ${JSON.stringify(envObject)};`;\n}\n","export default {\n    '.mjs': '.js',\n    '.jsx': '.js',\n    '.ts': '.js',\n    '.tsx': '.js',\n    '.vue': '.js',\n    '.svelte': '.js',\n    '.mdx': '.js',\n    '.svx': '.js',\n    '.elm': '.js',\n    '.yaml': '.json',\n    '.toml': '.json',\n    '.php': '.html',\n    '.md': '.html',\n    '.ejs': '.html',\n    '.njk': '.html',\n    '.scss': '.css',\n    '.sass': '.css',\n    '.less': '.css',\n};\n","import { startService } from 'esbuild';\nimport * as colors from 'kleur/colors';\nimport path from 'path';\nimport { promises as fs } from 'fs';\nlet esbuildService = null;\nconst IS_PREACT = /from\\s+['\"]preact['\"]/;\nfunction checkIsPreact(filePath, contents) {\n    return filePath.endsWith('.jsx') && IS_PREACT.test(contents);\n}\nfunction getLoader(filePath) {\n    const ext = path.extname(filePath);\n    if (ext === '.mjs') {\n        return 'js';\n    }\n    return ext.substr(1);\n}\nexport function esbuildPlugin(_, { input }) {\n    return {\n        name: '@snowpack/plugin-esbuild',\n        resolve: {\n            input,\n            output: ['.js'],\n        },\n        async load({ filePath }) {\n            esbuildService = esbuildService || (await startService());\n            const contents = await fs.readFile(filePath, 'utf-8');\n            const isPreact = checkIsPreact(filePath, contents);\n            const { js, warnings } = await esbuildService.transform(contents, {\n                loader: getLoader(filePath),\n                jsxFactory: isPreact ? 'h' : undefined,\n                jsxFragment: isPreact ? 'Fragment' : undefined,\n            });\n            for (const warning of warnings) {\n                console.error(colors.bold('! ') + filePath);\n                console.error('  ' + warning.text);\n            }\n            return { '.js': js || '' };\n        },\n    };\n}\nexport function stopEsbuild() {\n    esbuildService && esbuildService.stop();\n}\n","import buildScriptPlugin from '@snowpack/plugin-build-script';\nimport runScriptPlugin from '@snowpack/plugin-run-script';\nimport { cosmiconfigSync } from 'cosmiconfig';\nimport { all as merge } from 'deepmerge';\nimport fs from 'fs';\nimport { validate } from 'jsonschema';\nimport * as colors from 'kleur/colors';\nimport path from 'path';\nimport yargs from 'yargs-parser';\nimport srcFileExtensionMapping from './build/src-file-extension-mapping';\nimport { esbuildPlugin } from './plugins/plugin-esbuild';\nconst CONFIG_NAME = 'snowpack';\nconst ALWAYS_EXCLUDE = ['**/node_modules/**/*', '**/.types/**/*'];\n// default settings\nconst DEFAULT_CONFIG = {\n    exclude: ['__tests__/**/*', '**/*.@(spec|test).*'],\n    plugins: [],\n    alias: {},\n    installOptions: {\n        dest: 'web_modules',\n        externalPackage: [],\n        installTypes: false,\n        env: {},\n        namedExports: [],\n        rollup: {\n            plugins: [],\n            dedupe: [],\n        },\n    },\n    scripts: {},\n    devOptions: {\n        secure: false,\n        hostname: 'localhost',\n        port: 8080,\n        open: 'default',\n        out: 'build',\n        fallback: 'index.html',\n        hmr: true,\n    },\n    buildOptions: {\n        baseUrl: '/',\n        webModulesUrl: '/web_modules',\n        clean: false,\n        metaDir: '__snowpack__',\n        minify: true,\n    },\n};\nconst configSchema = {\n    type: 'object',\n    properties: {\n        extends: { type: 'string' },\n        install: { type: 'array', items: { type: 'string' } },\n        exclude: { type: 'array', items: { type: 'string' } },\n        plugins: { type: 'array' },\n        webDependencies: {\n            type: ['object'],\n            additionalProperties: { type: 'string' },\n        },\n        scripts: {\n            type: ['object'],\n            additionalProperties: { type: 'string' },\n        },\n        alias: {\n            type: 'object',\n            additionalProperties: { type: 'string' },\n        },\n        devOptions: {\n            type: 'object',\n            properties: {\n                secure: { type: 'boolean' },\n                port: { type: 'number' },\n                out: { type: 'string' },\n                fallback: { type: 'string' },\n                bundle: { type: 'boolean' },\n                open: { type: 'string' },\n                hmr: { type: 'boolean' },\n            },\n        },\n        installOptions: {\n            type: 'object',\n            properties: {\n                dest: { type: 'string' },\n                externalPackage: { type: 'array', items: { type: 'string' } },\n                treeshake: { type: 'boolean' },\n                installTypes: { type: 'boolean' },\n                sourceMap: { oneOf: [{ type: 'boolean' }, { type: 'string' }] },\n                alias: {\n                    type: 'object',\n                    additionalProperties: { type: 'string' },\n                },\n                env: {\n                    type: 'object',\n                    additionalProperties: {\n                        oneOf: [\n                            { id: 'EnvVarString', type: 'string' },\n                            { id: 'EnvVarNumber', type: 'number' },\n                            { id: 'EnvVarTrue', type: 'boolean', enum: [true] },\n                        ],\n                    },\n                },\n                rollup: {\n                    type: 'object',\n                    properties: {\n                        plugins: { type: 'array', items: { type: 'object' } },\n                        dedupe: {\n                            type: 'array',\n                            items: { type: 'string' },\n                        },\n                    },\n                },\n            },\n        },\n        buildOptions: {\n            type: ['object'],\n            properties: {\n                baseUrl: { type: 'string' },\n                clean: { type: 'boolean' },\n                metaDir: { type: 'string' },\n                minify: { type: 'boolean' },\n            },\n        },\n        proxy: {\n            type: 'object',\n        },\n    },\n};\n/**\n * Convert CLI flags to an incomplete Snowpack config representation.\n * We need to be careful about setting properties here if the flag value\n * is undefined, since the deep merge strategy would then overwrite good\n * defaults with 'undefined'.\n */\nfunction expandCliFlags(flags) {\n    const result = {\n        installOptions: {},\n        devOptions: {},\n        buildOptions: {},\n    };\n    const { help, version, reload, config, ...relevantFlags } = flags;\n    for (const [flag, val] of Object.entries(relevantFlags)) {\n        if (flag === '_' || flag.includes('-')) {\n            continue;\n        }\n        if (configSchema.properties[flag]) {\n            result[flag] = val;\n            continue;\n        }\n        if (configSchema.properties.installOptions.properties[flag]) {\n            result.installOptions[flag] = val;\n            continue;\n        }\n        if (configSchema.properties.devOptions.properties[flag]) {\n            result.devOptions[flag] = val;\n            continue;\n        }\n        if (configSchema.properties.buildOptions.properties[flag]) {\n            result.buildOptions[flag] = val;\n            continue;\n        }\n        console.error(`Unknown CLI flag: \"${flag}\"`);\n        process.exit(1);\n    }\n    if (result.installOptions.env) {\n        result.installOptions.env = result.installOptions.env.reduce((acc, id) => {\n            const index = id.indexOf('=');\n            const [key, val] = index > 0 ? [id.substr(0, index), id.substr(index + 1)] : [id, true];\n            acc[key] = val;\n            return acc;\n        }, {});\n    }\n    return result;\n}\n/** ensure extensions all have preceding dots */\nfunction parseScript(script) {\n    const [scriptType, extMatch] = script.toLowerCase().split(':');\n    const [inputMatch, outputMatch] = extMatch ? extMatch.split('->') : [];\n    const cleanInput = [...new Set(inputMatch.split(',').map((ext) => `.${ext}`))];\n    let cleanOutput = [];\n    if (outputMatch) {\n        cleanOutput = [...new Set(outputMatch.split(',').map((ext) => `.${ext}`))];\n    }\n    else if (cleanInput[0] === '.svelte') {\n        cleanOutput = ['.js', '.css'];\n    }\n    else if (cleanInput[0] === '.vue') {\n        cleanOutput = ['.js', '.css'];\n    }\n    else if (cleanInput.length > 0) {\n        cleanOutput = Array.from(new Set(cleanInput.map((ext) => srcFileExtensionMapping[ext] || ext)));\n    }\n    return {\n        scriptType,\n        input: cleanInput,\n        output: cleanOutput,\n    };\n}\n/** load and normalize plugins from config */\nfunction loadPlugins(config) {\n    const plugins = [];\n    function loadPluginFromScript(specifier) {\n        try {\n            const pluginLoc = require.resolve(specifier, { paths: [process.cwd()] });\n            return require(pluginLoc)(config); // no plugin options to load because weâre loading from a string\n        }\n        catch (err) {\n            // ignore\n        }\n    }\n    function loadPluginFromConfig(name, options) {\n        const pluginLoc = require.resolve(name, { paths: [process.cwd()] });\n        const pluginRef = require(pluginLoc);\n        let plugin;\n        try {\n            plugin = pluginRef.default ? pluginRef.default(config, options) : pluginRef(config, options);\n        }\n        catch (err) {\n            console.error(`[${name}] ${err}`);\n            throw err;\n        }\n        plugin.name = plugin.name || name;\n        // Legacy support: Map the new load() interface to the old build() interface\n        const { build, bundle } = plugin;\n        if (build) {\n            plugin.load = async (options) => {\n                const result = await build({\n                    ...options,\n                    contents: fs.readFileSync(options.filePath, 'utf-8'),\n                }).catch((err) => {\n                    console.error(`[${plugin.name}] ERROR: There was a problem running this older plugin. Please update the plugin to the latest version.`);\n                    throw err;\n                });\n                if (!result) {\n                    return null;\n                }\n                if (result.resources) {\n                    return { '.js': result.result, '.css': result.resources.css };\n                }\n                return result.result;\n            };\n        }\n        // Legacy support: Map the new optimize() interface to the old bundle() interface\n        if (bundle) {\n            plugin.optimize = async (options) => {\n                return bundle({\n                    srcDirectory: options.buildDirectory,\n                    destDirectory: options.buildDirectory,\n                    // @ts-ignore internal API only\n                    log: options.log,\n                    // It turns out, this was more or less broken (included all files, not just JS).\n                    // Confirmed no plugins are using this now, so safe to use an empty array.\n                    jsFilePaths: [],\n                }).catch((err) => {\n                    console.error(`[${plugin.name}] ERROR: There was a problem running this older plugin. Please update the plugin to the latest version.`);\n                    throw err;\n                });\n            };\n        }\n        if (!plugin.resolve &&\n            plugin.defaultBuildScript &&\n            plugin.defaultBuildScript.startsWith('build:')) {\n            const { input, output } = parseScript(plugin.defaultBuildScript);\n            plugin.resolve = { input, output };\n        }\n        else if (plugin.resolve) {\n            const { input, output } = plugin.resolve;\n            plugin.resolve = { input, output };\n        }\n        validatePlugin(plugin);\n        return plugin;\n    }\n    // 1. require & load config.scripts\n    // TODO: deprecate scripts and move out of this function\n    Object.entries(config.scripts).forEach(([target, cmd]) => {\n        const { scriptType, input, output } = parseScript(target);\n        if (config.plugins.some((p) => (Array.isArray(p) ? p[0] : p) === cmd)) {\n            handleConfigError(`[${name}]: loaded in both \\`scripts\\` and \\`plugins\\`. Please choose one (preferably \\`plugins\\`).`);\n        }\n        switch (scriptType) {\n            case 'run': {\n                if (target.endsWith('::watch')) {\n                    break;\n                }\n                const watchCmd = config.scripts[target + '::watch'];\n                plugins.push(runScriptPlugin(config, { cmd, watch: watchCmd || cmd }));\n                break;\n            }\n            case 'build': {\n                plugins.push(buildScriptPlugin(config, { input, output, cmd }));\n                break;\n            }\n            case 'bundle': {\n                plugins.push(loadPluginFromScript(cmd));\n                break;\n            }\n        }\n    });\n    // 2. config.plugins\n    config.plugins.forEach((ref) => {\n        const pluginName = Array.isArray(ref) ? ref[0] : ref;\n        const pluginOptions = Array.isArray(ref) ? ref[1] : {};\n        const plugin = loadPluginFromConfig(pluginName, pluginOptions);\n        plugins.push(plugin);\n    });\n    const needsDefaultPlugin = new Set(['.mjs', '.jsx', '.ts', '.tsx']);\n    plugins\n        .filter(({ resolve }) => !!resolve)\n        .reduce((arr, a) => arr.concat(a.resolve.input), [])\n        .forEach((ext) => needsDefaultPlugin.delete(ext));\n    if (needsDefaultPlugin.size > 0) {\n        plugins.unshift(esbuildPlugin(config, { input: [...needsDefaultPlugin] }));\n    }\n    const extensionMap = plugins.reduce((map, { resolve }) => {\n        if (resolve) {\n            for (const inputExt of resolve.input) {\n                map[inputExt] = resolve.output[0];\n            }\n        }\n        return map;\n    }, {});\n    return {\n        plugins,\n        extensionMap,\n    };\n}\n/**\n * Convert deprecated proxy scripts to\n * FUTURE: Remove this on next major release\n */\nfunction handleLegacyProxyScripts(config) {\n    for (const scriptId in config.scripts) {\n        if (!scriptId.startsWith('proxy:')) {\n            continue;\n        }\n        const cmdArr = config.scripts[scriptId].split(/\\s+/);\n        if (cmdArr[0] !== 'proxy') {\n            handleConfigError(`scripts[${scriptId}] must use the proxy command`);\n        }\n        cmdArr.shift();\n        const { to, _ } = yargs(cmdArr);\n        if (_.length !== 1) {\n            handleConfigError(`scripts[${scriptId}] must use the format: \"proxy http://SOME.URL --to /PATH\"`);\n        }\n        if (to && to[0] !== '/') {\n            handleConfigError(`scripts[${scriptId}]: \"--to ${to}\" must be a URL path, and start with a \"/\"`);\n        }\n        const { toUrl, fromUrl } = { fromUrl: _[0], toUrl: to };\n        if (config.proxy[toUrl]) {\n            handleConfigError(`scripts[${scriptId}]: Cannot overwrite proxy[${toUrl}].`);\n        }\n        config.proxy[toUrl] = fromUrl;\n        delete config.scripts[scriptId];\n    }\n    return config;\n}\nfunction normalizeProxies(proxies) {\n    return Object.entries(proxies).map(([pathPrefix, options]) => {\n        if (typeof options !== 'string') {\n            return [\n                pathPrefix,\n                {\n                    //@ts-ignore - Seems to be a strange 3.9.x bug\n                    on: {},\n                    ...options,\n                },\n            ];\n        }\n        return [\n            pathPrefix,\n            {\n                on: {\n                    proxyReq: (proxyReq, req) => {\n                        const proxyPath = proxyReq.path.split(req.url)[0];\n                        proxyReq.path = proxyPath + req.url.replace(pathPrefix, '');\n                    },\n                },\n                target: options,\n                changeOrigin: true,\n                secure: false,\n            },\n        ];\n    });\n}\nfunction normalizeMount(config) {\n    const mountedDirs = config.mount || {};\n    for (const [target, cmd] of Object.entries(config.scripts)) {\n        if (target.startsWith('mount:')) {\n            const cmdArr = cmd.split(/\\s+/);\n            if (cmdArr[0] !== 'mount') {\n                handleConfigError(`scripts[${target}] must use the mount command`);\n            }\n            cmdArr.shift();\n            const { to, _ } = yargs(cmdArr);\n            if (_.length !== 1) {\n                handleConfigError(`scripts[${target}] must use the format: \"mount dir [--to /PATH]\"`);\n            }\n            if (target === 'mount:web_modules') {\n                config.buildOptions.webModulesUrl = to;\n            }\n            else {\n                mountedDirs[cmdArr[0]] = to || `/${cmdArr[0]}`;\n            }\n        }\n    }\n    for (const [mountDir, mountUrl] of Object.entries(mountedDirs)) {\n        const fromDisk = path.posix.normalize(mountDir + '/');\n        delete mountedDirs[mountDir];\n        mountedDirs[fromDisk] = mountUrl;\n        if (mountUrl[0] !== '/') {\n            handleConfigError(`mount[${mountDir}]: Value \"${mountUrl}\" must be a URL path, and start with a \"/\"`);\n        }\n    }\n    // if no mounted directories, mount the root directory to the base URL\n    if (!Object.keys(mountedDirs).length) {\n        mountedDirs['.'] = '/';\n    }\n    return mountedDirs;\n}\nfunction normalizeAlias(config, createMountAlias) {\n    const cwd = process.cwd();\n    const cleanAlias = config.alias || {};\n    if (createMountAlias) {\n        for (const mountDir of Object.keys(config.mount)) {\n            if (mountDir !== '.') {\n                cleanAlias[removeTrailingSlash(mountDir)] = `./${mountDir}`;\n            }\n        }\n    }\n    for (const [target, replacement] of Object.entries(config.alias)) {\n        if (replacement.startsWith('./') ||\n            replacement.startsWith('../') ||\n            replacement.startsWith('/')) {\n            cleanAlias[target] = path.resolve(cwd, replacement);\n        }\n    }\n    return cleanAlias;\n}\n/** resolve --dest relative to cwd, etc. */\nfunction normalizeConfig(config) {\n    const cwd = process.cwd();\n    config.knownEntrypoints = config.install || [];\n    config.installOptions.dest = path.resolve(cwd, config.installOptions.dest);\n    config.devOptions.out = path.resolve(cwd, config.devOptions.out);\n    config.exclude = Array.from(new Set([...ALWAYS_EXCLUDE, ...config.exclude]));\n    if (!config.proxy) {\n        config.proxy = {};\n    }\n    // normalize config URL/path values\n    config.buildOptions.baseUrl = addTrailingSlash(config.buildOptions.baseUrl);\n    config.buildOptions.webModulesUrl = addLeadingSlash(config.buildOptions.webModulesUrl);\n    config.buildOptions.metaDir = removeLeadingSlash(removeTrailingSlash(config.buildOptions.metaDir));\n    const isLegacyMountConfig = !config.mount;\n    config = handleLegacyProxyScripts(config);\n    config.proxy = normalizeProxies(config.proxy);\n    config.mount = normalizeMount(config);\n    config.alias = normalizeAlias(config, isLegacyMountConfig);\n    // new pipeline\n    const { plugins, extensionMap } = loadPlugins(config);\n    config.plugins = plugins;\n    config._extensionMap = extensionMap;\n    // If any plugins defined knownEntrypoints, add them here\n    for (const { knownEntrypoints } of config.plugins) {\n        if (knownEntrypoints) {\n            config.knownEntrypoints = config.knownEntrypoints.concat(knownEntrypoints);\n        }\n    }\n    return config;\n}\nfunction handleConfigError(msg) {\n    console.error(`[error]: ${msg}`);\n    process.exit(1);\n}\nfunction handleValidationErrors(filepath, errors) {\n    console.error(colors.red(`! ${filepath || 'Configuration error'}`));\n    console.error(errors.map((err) => `    - ${err.toString()}`).join('\\n'));\n    console.error(`    See https://www.snowpack.dev/#configuration for more info.`);\n    process.exit(1);\n}\nfunction handleDeprecatedConfigError(mainMsg, ...msgs) {\n    console.error(colors.red(mainMsg));\n    msgs.forEach(console.error);\n    console.error(`See https://www.snowpack.dev/#configuration for more info.`);\n    process.exit(1);\n}\nfunction validateConfigAgainstV1(rawConfig, cliFlags) {\n    // Moved!\n    if (rawConfig.dedupe || cliFlags.dedupe) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `dedupe` is now `installOptions.rollup.dedupe`.');\n    }\n    if (rawConfig.namedExports) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `rollup.namedExports` is no longer required. See also: installOptions.namedExports');\n    }\n    if (rawConfig.installOptions?.rollup?.namedExports) {\n        delete rawConfig.installOptions.rollup.namedExports;\n        console.error(colors.yellow('[Snowpack v2.3.0] `rollup.namedExports` is no longer required. See also: installOptions.namedExports'));\n    }\n    if (rawConfig.rollup) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] top-level `rollup` config is now `installOptions.rollup`.');\n    }\n    if (rawConfig.installOptions?.include || cliFlags.include) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.include` is now handled via \"mount\" build scripts!');\n    }\n    if (rawConfig.installOptions?.exclude) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.exclude` is now `exclude`.');\n    }\n    if (Array.isArray(rawConfig.webDependencies)) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] The `webDependencies` array is now `install`.');\n    }\n    if (rawConfig.knownEntrypoints) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `knownEntrypoints` is now `install`.');\n    }\n    if (rawConfig.entrypoints) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `entrypoints` is now `install`.');\n    }\n    if (rawConfig.include) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] All files are now included by default. \"include\" config is safe to remove.', 'Whitelist & include specific folders via \"mount\" build scripts.');\n    }\n    // Replaced!\n    if (rawConfig.source || cliFlags.source) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `source` is now detected automatically, this config is safe to remove.');\n    }\n    if (rawConfig.stat || cliFlags.stat) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `stat` is now the default output, this config is safe to remove.');\n    }\n    if (rawConfig.scripts &&\n        Object.keys(rawConfig.scripts).filter((k) => k.startsWith('lintall')).length > 0) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `scripts[\"lintall:...\"]` has been renamed to scripts[\"run:...\"]');\n    }\n    if (rawConfig.scripts &&\n        Object.keys(rawConfig.scripts).filter((k) => k.startsWith('plugin:`')).length > 0) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `scripts[\"plugin:...\"]` have been renamed to scripts[\"build:...\"].');\n    }\n    // Removed!\n    if (rawConfig.devOptions?.dist) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `devOptions.dist` is no longer required. This config is safe to remove.', `If you'd still like to host your src/ directory at the \"/_dist/*\" URL, create a mount script:',\n      '    {\"scripts\": {\"mount:src\": \"mount src --to /_dist_\"}} `);\n    }\n    if (rawConfig.hash || cliFlags.hash) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.hash` has been replaced by `snowpack build`.');\n    }\n    if (rawConfig.installOptions?.nomodule || cliFlags.nomodule) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.nomodule` has been replaced by `snowpack build`.');\n    }\n    if (rawConfig.installOptions?.nomoduleOutput || cliFlags.nomoduleOutput) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.nomoduleOutput` has been replaced by `snowpack build`.');\n    }\n    if (rawConfig.installOptions?.babel || cliFlags.babel) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.babel` has been replaced by `snowpack build`.');\n    }\n    if (rawConfig.installOptions?.optimize) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.optimize` has been replaced by `snowpack build` minification.');\n    }\n    if (rawConfig.installOptions?.strict || cliFlags.strict) {\n        handleDeprecatedConfigError('[Snowpack v1 -> v2] `installOptions.strict` is no longer supported.');\n    }\n    if (rawConfig.installOptions?.alias) {\n        handleDeprecatedConfigError('[New in v2.7] `installOptions.alias` has been moved to a top-level `alias` config. (https://snowpack.dev#all-config-options)');\n    }\n}\nfunction validatePlugin(plugin) {\n    const pluginName = plugin.name;\n    if (plugin.resolve && !plugin.load) {\n        handleConfigError(`[plugin=${pluginName}] \"resolve\" config found but \"load()\" method missing.`);\n    }\n    if (!plugin.resolve && plugin.load) {\n        handleConfigError(`[plugin=${pluginName}] \"load\" method found but \"resolve()\" config missing.`);\n    }\n    if (plugin.resolve && !Array.isArray(plugin.resolve.input)) {\n        handleConfigError(`[plugin=${pluginName}] \"resolve.input\" should be an array of input file extensions.`);\n    }\n    if (plugin.resolve && !Array.isArray(plugin.resolve.output)) {\n        handleConfigError(`[plugin=${pluginName}] \"resolve.output\" should be an array of output file extensions.`);\n    }\n}\nexport function validatePluginLoadResult(plugin, result) {\n    const pluginName = plugin.name;\n    if (!result) {\n        return;\n    }\n    if (typeof result === 'string' && plugin.resolve.output.length !== 1) {\n        handleConfigError(`[plugin=${pluginName}] \"load()\" returned a string, but \"resolve.output\" contains multiple possible outputs. If multiple outputs are expected, the object return format is required.`);\n    }\n    const unexpectedOutput = typeof result === 'object' &&\n        Object.keys(result).find((fileExt) => !plugin.resolve.output.includes(fileExt));\n    if (unexpectedOutput) {\n        handleConfigError(`[plugin=${pluginName}] \"load()\" returned entry \"${unexpectedOutput}\" not found in \"resolve.output\": ${plugin.resolve.output}`);\n    }\n}\nexport function createConfiguration(config) {\n    const { errors: validationErrors } = validate(config, configSchema, {\n        propertyName: CONFIG_NAME,\n        allowUnknownAttributes: false,\n    });\n    if (validationErrors.length > 0) {\n        return [validationErrors, undefined];\n    }\n    const mergedConfig = merge([DEFAULT_CONFIG, config]);\n    return [null, normalizeConfig(mergedConfig)];\n}\nexport function loadAndValidateConfig(flags, pkgManifest) {\n    const explorerSync = cosmiconfigSync(CONFIG_NAME, {\n        // only support these 3 types of config for now\n        searchPlaces: ['package.json', 'snowpack.config.js', 'snowpack.config.json'],\n        // don't support crawling up the folder tree:\n        stopDir: path.dirname(process.cwd()),\n    });\n    let result;\n    // if user specified --config path, load that\n    if (flags.config) {\n        result = explorerSync.load(path.resolve(process.cwd(), flags.config));\n        if (!result) {\n            handleConfigError(`Could not locate Snowpack config at ${flags.config}`);\n        }\n    }\n    // If no config was found above, search for one.\n    result = result || explorerSync.search();\n    // If still no config found, assume none exists and use the default config.\n    if (!result || !result.config || result.isEmpty) {\n        result = { config: { ...DEFAULT_CONFIG } };\n    }\n    // validate against schema; throw helpful user if invalid\n    const config = result.config;\n    validateConfigAgainstV1(config, flags);\n    const cliConfig = expandCliFlags(flags);\n    let extendConfig = {};\n    if (config.extends) {\n        const extendConfigLoc = config.extends.startsWith('.')\n            ? path.resolve(path.dirname(result.filepath), config.extends)\n            : require.resolve(config.extends, { paths: [process.cwd()] });\n        const extendResult = explorerSync.load(extendConfigLoc);\n        if (!extendResult) {\n            handleConfigError(`Could not locate Snowpack config at ${flags.config}`);\n            process.exit(1);\n        }\n        extendConfig = extendResult.config;\n        const extendValidation = validate(extendConfig, configSchema, {\n            allowUnknownAttributes: false,\n            propertyName: CONFIG_NAME,\n        });\n        if (extendValidation.errors && extendValidation.errors.length > 0) {\n            handleValidationErrors(result.filepath, extendValidation.errors);\n            process.exit(1);\n        }\n        if (extendConfig.plugins) {\n            const extendConfgDir = path.dirname(extendConfigLoc);\n            extendConfig.plugins = extendConfig.plugins.map((plugin) => {\n                const name = Array.isArray(plugin) ? plugin[0] : plugin;\n                const absName = path.isAbsolute(name)\n                    ? name\n                    : require.resolve(name, { paths: [extendConfgDir] });\n                return Array.isArray(plugin) ? plugin.splice(0, 1, absName) : absName;\n            });\n        }\n    }\n    // if valid, apply config over defaults\n    const mergedConfig = merge([\n        pkgManifest.homepage ? { buildOptions: { baseUrl: pkgManifest.homepage } } : {},\n        extendConfig,\n        { webDependencies: pkgManifest.webDependencies },\n        config,\n        cliConfig,\n    ]);\n    for (const webDependencyName of Object.keys(mergedConfig.webDependencies || {})) {\n        if (pkgManifest.dependencies && pkgManifest.dependencies[webDependencyName]) {\n            handleConfigError(`\"${webDependencyName}\" is included in \"webDependencies\". Please remove it from your package.json \"dependencies\" config.`);\n        }\n        if (pkgManifest.devDependencies && pkgManifest.devDependencies[webDependencyName]) {\n            handleConfigError(`\"${webDependencyName}\" is included in \"webDependencies\". Please remove it from your package.json \"devDependencies\" config.`);\n        }\n    }\n    const [validationErrors, configResult] = createConfiguration(mergedConfig);\n    if (validationErrors) {\n        handleValidationErrors(result.filepath, validationErrors);\n        process.exit(1);\n    }\n    return configResult;\n}\nexport function removeLeadingSlash(path) {\n    return path.replace(/^[/\\\\]+/, '');\n}\nexport function removeTrailingSlash(path) {\n    return path.replace(/[/\\\\]+$/, '');\n}\nexport function addLeadingSlash(path) {\n    return path.replace(/^\\/?/, '/');\n}\nexport function addTrailingSlash(path) {\n    return path.replace(/\\/?$/, '/');\n}\n","import { promises as fs } from 'fs';\nimport path from 'path';\nimport { getEncodingType, getExt } from '../util';\nimport { validatePluginLoadResult } from '../config';\nexport function getInputsFromOutput(fileLoc, plugins) {\n    const { baseExt } = getExt(fileLoc);\n    const potentialInputs = new Set([fileLoc]);\n    for (const plugin of plugins) {\n        if (plugin.resolve && plugin.resolve.output.includes(baseExt)) {\n            plugin.resolve.input.forEach((inp) => potentialInputs.add(fileLoc.replace(baseExt, inp)));\n        }\n    }\n    return Array.from(potentialInputs);\n}\n/**\n * Build Plugin First Pass: If a plugin defines a\n * `resolve` object, check it against the current\n * file's extension. If it matches, call the load()\n * functon and return it's result.\n *\n * If no match is found, fall back to just reading\n * the file from disk and return it.\n */\nasync function runPipelineLoadStep(srcPath, { plugins, messageBus, isDev, isHmrEnabled }) {\n    const srcExt = getExt(srcPath).baseExt;\n    for (const step of plugins) {\n        if (!step.resolve || !step.resolve.input.includes(srcExt)) {\n            continue;\n        }\n        if (!step.load) {\n            continue;\n        }\n        const result = await step.load({\n            fileExt: srcExt,\n            filePath: srcPath,\n            isDev,\n            isHmrEnabled,\n            // @ts-ignore: internal API only\n            log: (msg, data = {}) => {\n                messageBus.emit(msg, {\n                    ...data,\n                    id: step.name,\n                    msg: data.msg && `${data.msg} [${path.relative(process.cwd(), srcPath)}]`,\n                });\n            },\n        });\n        validatePluginLoadResult(step, result);\n        if (typeof result === 'string') {\n            const mainOutputExt = step.resolve.output[0];\n            return { [mainOutputExt]: result };\n        }\n        else if (result && typeof result === 'object') {\n            return result;\n        }\n        else {\n            continue;\n        }\n    }\n    return { [srcExt]: await fs.readFile(srcPath, getEncodingType(srcExt)) };\n}\n/**\n * Build Plugin Second Pass: If a plugin defines a\n * transform() method,call it. Transform cannot change\n * the file extension, and was designed to run on\n * every file type and return null/undefined if no\n * change needed.\n */\nasync function runPipelineTransformStep(output, srcPath, { plugins, messageBus, isDev }) {\n    const srcExt = getExt(srcPath).baseExt;\n    const rootFileName = path.basename(srcPath).replace(srcExt, '');\n    for (const step of plugins) {\n        if (!step.transform) {\n            continue;\n        }\n        for (const destExt of Object.keys(output)) {\n            const destBuildFile = output[destExt];\n            const result = await step.transform({\n                contents: destBuildFile,\n                fileExt: destExt,\n                filePath: rootFileName + destExt,\n                isDev,\n                // @ts-ignore: internal API only\n                log: (msg, data = {}) => {\n                    messageBus.emit(msg, {\n                        ...data,\n                        id: step.name,\n                        msg: data.msg && `[${srcPath}] ${data.msg}`,\n                    });\n                },\n                // @ts-ignore: Deprecated\n                urlPath: `./${path.basename(rootFileName + destExt)}`,\n            });\n            if (typeof result === 'string') {\n                output[destExt] = result;\n            }\n            else if (result && typeof result === 'object' && result.result) {\n                output[destExt] = result.result;\n            }\n        }\n    }\n    return output;\n}\nexport async function runPipelineOptimizeStep(buildDirectory, { plugins, messageBus }) {\n    for (const step of plugins) {\n        if (!step.optimize) {\n            continue;\n        }\n        await step.optimize({\n            buildDirectory,\n            // @ts-ignore: internal API only\n            log: (msg) => {\n                messageBus.emit('WORKER_MSG', { id: step.name, level: 'log', msg });\n            },\n        });\n    }\n    return null;\n}\n/** Core Snowpack file pipeline builder */\nexport async function buildFile(srcPath, buildFileOptions) {\n    // Pass 1: Find the first plugin to load this file, and return the result\n    const loadResult = await runPipelineLoadStep(srcPath, buildFileOptions);\n    // Pass 2: Pass that result through every plugin transfomr() method.\n    const transformResult = await runPipelineTransformStep(loadResult, srcPath, buildFileOptions);\n    // Return the final build result.\n    return transformResult;\n}\n","import fs from 'fs';\nimport path from 'path';\nimport { findMatchingAliasEntry, getExt, replaceExt, URL_HAS_PROTOCOL_REGEX } from '../util';\nimport srcFileExtensionMapping from './src-file-extension-mapping';\nconst cwd = process.cwd();\n/** Perform a file disk lookup for the requested import specifier. */\nexport function getImportStats(dirLoc, spec) {\n    const importedFileOnDisk = path.resolve(dirLoc, spec);\n    try {\n        return fs.statSync(importedFileOnDisk);\n    }\n    catch (err) {\n        // file doesn't exist, that's fine\n    }\n    return false;\n}\n/** Resolve an import based on the state of the file/folder found on disk. */\nfunction resolveSourceSpecifier(spec, stats, config) {\n    if (stats && stats.isDirectory()) {\n        const trailingSlash = spec.endsWith('/') ? '' : '/';\n        spec = spec + trailingSlash + 'index.js';\n    }\n    else if (!stats && !spec.endsWith('.js') && !spec.endsWith('.css')) {\n        spec = spec + '.js';\n    }\n    const { baseExt } = getExt(spec);\n    const extToReplace = config._extensionMap[baseExt] || srcFileExtensionMapping[baseExt];\n    if (extToReplace) {\n        spec = replaceExt(spec, extToReplace);\n    }\n    return spec;\n}\n/**\n * Create a import resolver function, which converts any import relative to the given file at \"fileLoc\"\n * to a proper URL. Returns false if no matching import was found, which usually indicates a package\n * not found in the import map.\n */\nexport function createImportResolver({ fileLoc, dependencyImportMap, config, }) {\n    return function importResolver(spec) {\n        if (URL_HAS_PROTOCOL_REGEX.test(spec)) {\n            return spec;\n        }\n        if (spec.startsWith('/') || spec.startsWith('./') || spec.startsWith('../')) {\n            const importStats = getImportStats(path.dirname(fileLoc), spec);\n            spec = resolveSourceSpecifier(spec, importStats, config);\n            return spec;\n        }\n        const aliasEntry = findMatchingAliasEntry(config, spec);\n        if (aliasEntry && aliasEntry.type === 'path') {\n            const { from, to } = aliasEntry;\n            let result = spec.replace(from, to);\n            const importStats = getImportStats(cwd, result);\n            result = resolveSourceSpecifier(result, importStats, config);\n            result = path.posix.relative(path.dirname(fileLoc), result);\n            if (!result.startsWith('.')) {\n                result = './' + result;\n            }\n            return result;\n        }\n        if (dependencyImportMap) {\n            // NOTE: We don't need special handling for an alias here, since the aliased \"from\"\n            // is already the key in the import map. The aliased \"to\" value is also an entry.\n            const importMapEntry = dependencyImportMap.imports[spec];\n            if (importMapEntry) {\n                let resolved = path.posix.resolve(config.buildOptions.webModulesUrl, importMapEntry);\n                // Windows fix: temporarily use backslashes until fully resolved (will be transformed to forward slashes later)\n                if (path.sep === '\\\\') {\n                    resolved = resolved.replace(/\\//g, '\\\\');\n                }\n                return resolved;\n            }\n        }\n        return false;\n    };\n}\n","import { HTML_JS_REGEX } from './util';\nconst { parse } = require('es-module-lexer');\nfunction spliceString(source, withSlice, start, end) {\n    return source.slice(0, start) + (withSlice || '') + source.slice(end);\n}\nexport async function scanCodeImportsExports(code) {\n    const [imports] = await parse(code);\n    return imports.filter((imp) => {\n        //imp.d = -2 = import.meta.url = we can skip this for now\n        if (imp.d === -2) {\n            return false;\n        }\n        // imp.d > -1 === dynamic import\n        if (imp.d > -1) {\n            const importStatement = code.substring(imp.s, imp.e);\n            const importSpecifierMatch = importStatement.match(/^\\s*['\"](.*)['\"]\\s*$/m);\n            return !!importSpecifierMatch;\n        }\n        return true;\n    });\n}\nexport async function transformEsmImports(_code, replaceImport) {\n    const imports = await scanCodeImportsExports(_code);\n    let rewrittenCode = _code;\n    for (const imp of imports.reverse()) {\n        let spec = rewrittenCode.substring(imp.s, imp.e);\n        if (imp.d > -1) {\n            const importSpecifierMatch = spec.match(/^\\s*['\"](.*)['\"]\\s*$/m);\n            spec = importSpecifierMatch[1];\n        }\n        let rewrittenImport = replaceImport(spec);\n        if (imp.d > -1) {\n            rewrittenImport = JSON.stringify(rewrittenImport);\n        }\n        rewrittenCode = spliceString(rewrittenCode, rewrittenImport, imp.s, imp.e);\n    }\n    return rewrittenCode;\n}\nasync function transformHtmlImports(code, replaceImport) {\n    let rewrittenCode = code;\n    let match;\n    const importRegex = new RegExp(HTML_JS_REGEX);\n    while ((match = importRegex.exec(rewrittenCode))) {\n        const [, scriptTag, scriptCode] = match;\n        // Only transform a script element if it contains inlined code / is not empty.\n        if (scriptCode.trim()) {\n            rewrittenCode = spliceString(rewrittenCode, await transformEsmImports(scriptCode, replaceImport), match.index + scriptTag.length, match.index + scriptTag.length + scriptCode.length);\n        }\n    }\n    return rewrittenCode;\n}\nexport async function transformFileImports({ baseExt, contents }, replaceImport) {\n    if (baseExt === '.js') {\n        return transformEsmImports(contents, replaceImport);\n    }\n    if (baseExt === '.html') {\n        return transformHtmlImports(contents, replaceImport);\n    }\n    throw new Error(`Incompatible filetype: cannot scan ${baseExt} files for ESM imports. This is most likely an error within Snowpack.`);\n}\n","import merge from 'deepmerge';\nimport { startService as esbuildStartService } from 'esbuild';\nimport { EventEmitter } from 'events';\nimport { promises as fs } from 'fs';\nimport glob from 'glob';\nimport * as colors from 'kleur/colors';\nimport mkdirp from 'mkdirp';\nimport path from 'path';\nimport { performance } from 'perf_hooks';\nimport rimraf from 'rimraf';\nimport url from 'url';\nimport util from 'util';\nimport { generateEnvModule, wrapHtmlResponse, wrapImportMeta, wrapImportProxy, } from '../build/build-import-proxy';\nimport { buildFile, runPipelineOptimizeStep } from '../build/build-pipeline';\nimport { createImportResolver } from '../build/import-resolver';\nimport srcFileExtensionMapping from '../build/src-file-extension-mapping';\nimport { removeLeadingSlash } from '../config';\nimport { stopEsbuild } from '../plugins/plugin-esbuild';\nimport { transformFileImports } from '../rewrite-imports';\nimport { printStats } from '../stats-formatter';\nimport { getEncodingType, getExt, replaceExt } from '../util';\nimport { getInstallTargets, run as installRunner } from './install';\nasync function installOptimizedDependencies(allFilesToResolveImports, installDest, commandOptions) {\n    console.log(colors.yellow('! installing dependencies...'));\n    const installConfig = merge(commandOptions.config, {\n        installOptions: {\n            dest: installDest,\n            env: { NODE_ENV: process.env.NODE_ENV || 'production' },\n            treeshake: commandOptions.config.installOptions.treeshake ?? true,\n        },\n    });\n    // 1. Scan imports from your final built JS files.\n    const installTargets = await getInstallTargets(installConfig, Object.values(allFilesToResolveImports));\n    // 2. Install dependencies, based on the scan of your final build.\n    const installResult = await installRunner({\n        ...commandOptions,\n        installTargets,\n        config: installConfig,\n    });\n    // 3. Print stats immediate after install output.\n    if (installResult.stats) {\n        console.log(printStats(installResult.stats));\n    }\n    return installResult;\n}\nexport async function command(commandOptions) {\n    const { cwd, config } = commandOptions;\n    const messageBus = new EventEmitter();\n    // TODO: update this with a more robust / typed log event\n    function logEvent({ level, id, msg, args }) {\n        let logger = console.log;\n        let color = (stdout) => stdout;\n        if (level === 'warn') {\n            logger = console.warn;\n            color = colors.yellow;\n        }\n        if (level === 'error') {\n            color = colors.red;\n            logger = console.error;\n        }\n        const output = msg || util.format.apply(util, args);\n        logger(`${id ? colors.blue(`[${id}] `) : ''}${color(output)}`);\n    }\n    messageBus.on('CONSOLE', logEvent);\n    messageBus.on('WORKER_COMPLETE', logEvent);\n    messageBus.on('WORKER_MSG', logEvent);\n    messageBus.on('WORKER_RESET', logEvent);\n    messageBus.on('WORKER_START', logEvent);\n    messageBus.on('WORKER_UPDATE', logEvent);\n    const buildDirectoryLoc = config.devOptions.out;\n    const internalFilesBuildLoc = path.join(buildDirectoryLoc, config.buildOptions.metaDir);\n    if (config.buildOptions.clean) {\n        rimraf.sync(buildDirectoryLoc);\n    }\n    mkdirp.sync(buildDirectoryLoc);\n    mkdirp.sync(internalFilesBuildLoc);\n    let relDest = path.relative(cwd, config.devOptions.out);\n    if (!relDest.startsWith(`..${path.sep}`)) {\n        relDest = `.${path.sep}` + relDest;\n    }\n    for (const runPlugin of config.plugins) {\n        if (runPlugin.run) {\n            await runPlugin\n                .run({\n                isDev: false,\n                isHmrEnabled: false,\n                // @ts-ignore: internal API only\n                log: (msg, data = {}) => {\n                    messageBus.emit(msg, { ...data, id: runPlugin.name });\n                },\n            })\n                .catch((err) => {\n                messageBus.emit('CONSOLE', { level: 'error', id: runPlugin.name, ...err });\n            });\n        }\n    }\n    // Write the `import.meta.env` contents file to disk\n    await fs.writeFile(path.join(internalFilesBuildLoc, 'env.js'), generateEnvModule('production'));\n    const includeFileSets = [];\n    for (const [fromDisk, toUrl] of Object.entries(config.mount)) {\n        const dirDisk = path.resolve(cwd, fromDisk);\n        const dirDest = path.resolve(buildDirectoryLoc, removeLeadingSlash(toUrl));\n        const allFiles = glob.sync(`**/*`, {\n            ignore: config.exclude,\n            cwd: dirDisk,\n            absolute: true,\n            nodir: true,\n            dot: true,\n        });\n        const allBuildNeededFiles = [];\n        await Promise.all(allFiles.map(async (f) => {\n            f = path.resolve(f); // this is necessary since glob.sync() returns paths with / on windows.  path.resolve() will switch them to the native path separator.\n            allBuildNeededFiles.push(f);\n        }));\n        includeFileSets.push([dirDisk, dirDest, allBuildNeededFiles]);\n    }\n    const allBuiltFromFiles = new Set();\n    const allFilesToResolveImports = {};\n    console.log(colors.yellow('! building source...'));\n    const buildStart = performance.now();\n    for (const [dirDisk, dirDest, allFiles] of includeFileSets) {\n        for (const locOnDisk of allFiles) {\n            const { baseExt: fileExt } = getExt(locOnDisk);\n            let outLoc = locOnDisk.replace(dirDisk, dirDest);\n            let builtLocOnDisk = locOnDisk;\n            const extToReplace = config._extensionMap[fileExt] || srcFileExtensionMapping[fileExt];\n            if (extToReplace) {\n                outLoc = replaceExt(outLoc, extToReplace);\n                builtLocOnDisk = replaceExt(builtLocOnDisk, extToReplace);\n            }\n            const builtFileOutput = await buildFile(locOnDisk, {\n                plugins: config.plugins,\n                messageBus,\n                isDev: false,\n                isHmrEnabled: false,\n            });\n            allBuiltFromFiles.add(locOnDisk);\n            const { baseExt, expandedExt } = getExt(outLoc);\n            let contents = builtFileOutput[config._extensionMap[fileExt] || srcFileExtensionMapping[fileExt] || fileExt];\n            if (!contents) {\n                continue;\n            }\n            const cssOutPath = outLoc.replace(/.js$/, '.css');\n            mkdirp.sync(path.dirname(outLoc));\n            switch (baseExt) {\n                case '.js': {\n                    if (builtFileOutput['.css']) {\n                        await fs.mkdir(path.dirname(cssOutPath), { recursive: true });\n                        await fs.writeFile(cssOutPath, builtFileOutput['.css'], 'utf-8');\n                        contents = `import './${path.basename(cssOutPath)}';\\n` + contents;\n                    }\n                    contents = wrapImportMeta({ code: contents, env: true, isDev: false, hmr: false, config });\n                    allFilesToResolveImports[outLoc] = { baseExt, expandedExt, contents, locOnDisk };\n                    break;\n                }\n                case '.html': {\n                    contents = wrapHtmlResponse({\n                        code: contents,\n                        isDev: false,\n                        hmr: false,\n                        config,\n                    });\n                    allFilesToResolveImports[outLoc] = { baseExt, expandedExt, contents, locOnDisk };\n                    break;\n                }\n            }\n            await fs.writeFile(outLoc, contents, getEncodingType(baseExt));\n        }\n    }\n    stopEsbuild();\n    const buildEnd = performance.now();\n    console.log(`${colors.green('â')} ${colors.bold('snowpack')} build complete ${colors.dim(`[${((buildEnd - buildStart) / 1000).toFixed(2)}s]`)}`);\n    const installDest = path.join(buildDirectoryLoc, config.buildOptions.webModulesUrl);\n    const installResult = await installOptimizedDependencies(allFilesToResolveImports, installDest, commandOptions);\n    if (!installResult.success || installResult.hasError) {\n        process.exit(1);\n    }\n    const allImportProxyFiles = new Set();\n    for (const [outLoc, file] of Object.entries(allFilesToResolveImports)) {\n        const resolveImportSpecifier = createImportResolver({\n            fileLoc: file.locOnDisk,\n            dependencyImportMap: installResult.importMap,\n            config,\n        });\n        const resolvedCode = await transformFileImports(file, (spec) => {\n            // Try to resolve the specifier to a known URL in the project\n            let resolvedImportUrl = resolveImportSpecifier(spec);\n            if (!resolvedImportUrl || url.parse(resolvedImportUrl).protocol) {\n                return spec;\n            }\n            const extName = path.extname(resolvedImportUrl);\n            const isProxyImport = extName && extName !== '.js';\n            // We treat \".proxy.js\" files special: we need to make sure that they exist on disk\n            // in the final build, so we mark them to be written to disk at the next step.\n            const isAbsoluteUrlPath = path.isAbsolute(resolvedImportUrl);\n            if (isProxyImport) {\n                resolvedImportUrl = resolvedImportUrl + '.proxy.js';\n                if (isAbsoluteUrlPath) {\n                    allImportProxyFiles.add(path.resolve(buildDirectoryLoc, removeLeadingSlash(resolvedImportUrl)));\n                }\n                else {\n                    allImportProxyFiles.add(path.resolve(path.dirname(outLoc), resolvedImportUrl));\n                }\n            }\n            // When dealing with an absolute import path, we need to honor the baseUrl\n            if (isAbsoluteUrlPath) {\n                resolvedImportUrl = path.relative(path.dirname(outLoc), path.resolve(buildDirectoryLoc, removeLeadingSlash(resolvedImportUrl)));\n            }\n            if (!resolvedImportUrl.startsWith('.'))\n                resolvedImportUrl = './' + removeLeadingSlash(resolvedImportUrl);\n            return resolvedImportUrl.replace(/\\\\/g, '/'); // replace Windows backslashes at the end, after resolution\n        });\n        await fs.mkdir(path.dirname(outLoc), { recursive: true });\n        await fs.writeFile(outLoc, resolvedCode);\n    }\n    for (const importProxyFileLoc of allImportProxyFiles) {\n        const originalFileLoc = importProxyFileLoc.replace('.proxy.js', '');\n        const proxiedExt = path.extname(originalFileLoc);\n        const proxiedCode = await fs.readFile(originalFileLoc, getEncodingType(proxiedExt));\n        const proxiedUrl = originalFileLoc.substr(buildDirectoryLoc.length).replace(/\\\\/g, '/');\n        const proxyCode = await wrapImportProxy({\n            url: proxiedUrl,\n            code: proxiedCode,\n            isDev: false,\n            hmr: false,\n            config,\n        });\n        await fs.writeFile(importProxyFileLoc, proxyCode, getEncodingType('.js'));\n    }\n    await runPipelineOptimizeStep(buildDirectoryLoc, {\n        plugins: config.plugins,\n        messageBus,\n        isDev: false,\n        isHmrEnabled: false,\n    });\n    if (config.buildOptions.minify) {\n        const minifierStart = performance.now();\n        console.log(colors.yellow('! minifying javascript...'));\n        let minifierService = await esbuildStartService();\n        const allJsFiles = glob.sync(path.join(buildDirectoryLoc, '**/*.js'));\n        for (const jsFile of allJsFiles) {\n            const jsFileContents = await fs.readFile(jsFile, 'utf-8');\n            const { js } = await minifierService.transform(jsFileContents, { minify: true });\n            js && (await fs.writeFile(jsFile, js, 'utf-8'));\n        }\n        const minifierEnd = performance.now();\n        console.log(`${colors.green('â')} ${colors.bold('snowpack')} minification complete ${colors.dim(`[${((minifierEnd - minifierStart) / 1000).toFixed(2)}s]`)}`);\n        minifierService.stop();\n    }\n    process.stdout.write(`\\n${colors.underline(colors.green(colors.bold('â¶ Build Complete!')))}\\n\\n`);\n}\n","import WebSocket from 'ws';\nexport class EsmHmrEngine {\n    constructor(options = {}) {\n        this.clients = new Set();\n        this.dependencyTree = new Map();\n        const wss = options.server\n            ? new WebSocket.Server({ noServer: true })\n            : new WebSocket.Server({ port: 12321 });\n        if (options.server) {\n            options.server.on('upgrade', (req, socket, head) => {\n                // Only handle upgrades to ESM-HMR requests, ignore others.\n                if (req.headers['sec-websocket-protocol'] !== 'esm-hmr') {\n                    return;\n                }\n                wss.handleUpgrade(req, socket, head, (client) => {\n                    wss.emit('connection', client, req);\n                });\n            });\n        }\n        wss.on('connection', (client) => {\n            this.connectClient(client);\n            this.registerListener(client);\n        });\n    }\n    registerListener(client) {\n        client.on('message', (data) => {\n            const message = JSON.parse(data.toString());\n            if (message.type === 'hotAccept') {\n                const entry = this.getEntry(message.id, true);\n                entry.isHmrAccepted = true;\n                entry.isHmrEnabled = true;\n            }\n        });\n    }\n    createEntry(sourceUrl) {\n        const newEntry = {\n            dependencies: new Set(),\n            dependents: new Set(),\n            needsReplacement: false,\n            isHmrEnabled: false,\n            isHmrAccepted: false,\n        };\n        this.dependencyTree.set(sourceUrl, newEntry);\n        return newEntry;\n    }\n    getEntry(sourceUrl, createIfNotFound = false) {\n        const result = this.dependencyTree.get(sourceUrl);\n        if (result) {\n            return result;\n        }\n        if (createIfNotFound) {\n            return this.createEntry(sourceUrl);\n        }\n        return null;\n    }\n    setEntry(sourceUrl, imports, isHmrEnabled = false) {\n        const result = this.getEntry(sourceUrl, true);\n        const outdatedDependencies = new Set(result.dependencies);\n        result.isHmrEnabled = isHmrEnabled;\n        for (const importUrl of imports) {\n            this.addRelationship(sourceUrl, importUrl);\n            outdatedDependencies.delete(importUrl);\n        }\n        for (const importUrl of outdatedDependencies) {\n            this.removeRelationship(sourceUrl, importUrl);\n        }\n    }\n    removeRelationship(sourceUrl, importUrl) {\n        let importResult = this.getEntry(importUrl);\n        importResult && importResult.dependents.delete(sourceUrl);\n        const sourceResult = this.getEntry(sourceUrl);\n        sourceResult && sourceResult.dependencies.delete(importUrl);\n    }\n    addRelationship(sourceUrl, importUrl) {\n        if (importUrl !== sourceUrl) {\n            let importResult = this.getEntry(importUrl, true);\n            importResult.dependents.add(sourceUrl);\n            const sourceResult = this.getEntry(sourceUrl, true);\n            sourceResult.dependencies.add(importUrl);\n        }\n    }\n    markEntryForReplacement(entry, state) {\n        entry.needsReplacement = state;\n    }\n    broadcastMessage(data) {\n        this.clients.forEach((client) => {\n            if (client.readyState === WebSocket.OPEN) {\n                client.send(JSON.stringify(data));\n            }\n            else {\n                this.disconnectClient(client);\n            }\n        });\n    }\n    connectClient(client) {\n        this.clients.add(client);\n    }\n    disconnectClient(client) {\n        client.terminate();\n        this.clients.delete(client);\n    }\n    disconnectAllClients() {\n        for (const client of this.clients) {\n            this.disconnectClient(client);\n        }\n    }\n}\n","import detectPort from 'detect-port';\nimport * as colors from 'kleur/colors';\nimport path from 'path';\nimport readline from 'readline';\nimport util from 'util';\nimport { isYarn } from '../util';\nconst cwd = process.cwd();\n/**\n * Get the actual port, based on the `defaultPort`.\n * If the default port was not available, then we'll prompt the user if its okay\n * to use the next available port.\n */\nexport async function getPort(defaultPort) {\n    const bestAvailablePort = await detectPort(defaultPort);\n    if (defaultPort !== bestAvailablePort) {\n        let useNextPort = false;\n        if (process.stdout.isTTY) {\n            const rl = readline.createInterface({ input: process.stdin, output: process.stdout });\n            useNextPort = await new Promise((resolve) => {\n                rl.question(colors.yellow(`! Port ${colors.bold(defaultPort)} not available. Run on port ${colors.bold(bestAvailablePort)} instead? (Y/n) `), (answer) => {\n                    resolve(!/^no?$/i.test(answer));\n                });\n            });\n            rl.close();\n        }\n        if (!useNextPort) {\n            console.error(colors.red(`â Port ${colors.bold(defaultPort)} not available. Use ${colors.bold('--port')} to specify a different port.`));\n            console.error();\n            process.exit(1);\n        }\n    }\n    return bestAvailablePort;\n}\nfunction getStateString(workerState, isWatch) {\n    if (workerState.state) {\n        if (Array.isArray(workerState.state)) {\n            return [colors[workerState.state[1]], workerState.state[0]];\n        }\n        return [colors.dim, workerState.state];\n    }\n    if (workerState.done) {\n        return workerState.error ? [colors.red, 'FAIL'] : [colors.green, 'DONE'];\n    }\n    if (isWatch) {\n        if (workerState.config.watch) {\n            return [colors.dim, 'WATCH'];\n        }\n    }\n    return [colors.dim, 'READY'];\n}\nconst WORKER_BASE_STATE = { done: false, error: null, state: null, output: '' };\nexport function paint(bus, scripts, buildMode, devMode) {\n    let port;\n    let hostname;\n    let protocol = '';\n    let startTimeMs;\n    let ips = [];\n    let consoleOutput = '';\n    let installOutput = '';\n    let isInstalling = false;\n    let hasBeenCleared = false;\n    let missingWebModule = null;\n    const allWorkerStates = {};\n    const allFileBuilds = new Set();\n    for (const script of scripts) {\n        allWorkerStates[script] = { ...WORKER_BASE_STATE };\n    }\n    function setupWorker(id) {\n        if (!allWorkerStates[id]) {\n            allWorkerStates[id] = { ...WORKER_BASE_STATE };\n        }\n    }\n    function repaint() {\n        process.stdout.write(process.platform === 'win32' ? '\\x1B[2J\\x1B[0f' : '\\x1B[2J\\x1B[3J\\x1B[H');\n        process.stdout.write(`${colors.bold('Snowpack')}\\n\\n`);\n        // Dashboard\n        if (devMode) {\n            const isServerStarted = startTimeMs > 0 && port > 0 && protocol;\n            if (isServerStarted) {\n                process.stdout.write(`  ${colors.bold(colors.cyan(`${protocol}//${hostname}:${port}`))}`);\n                for (const ip of ips) {\n                    process.stdout.write(`${colors.cyan(` â¢ `)}${colors.bold(colors.cyan(`${protocol}//${ip}:${port}`))}`);\n                }\n                process.stdout.write('\\n');\n                process.stdout.write(colors.dim(startTimeMs < 1000 ? `  Server started in ${startTimeMs}ms.` : `  Server started.`));\n                if (allFileBuilds.size > 0) {\n                    process.stdout.write(colors.dim(` Building...`));\n                }\n                process.stdout.write('\\n\\n');\n            }\n            else {\n                process.stdout.write(colors.dim(`  Server startingâ¦`) + '\\n\\n');\n            }\n        }\n        if (buildMode) {\n            process.stdout.write('  ' + colors.bold(colors.cyan(buildMode.dest)));\n            process.stdout.write(colors.dim(` Building your application...\\n\\n`));\n        }\n        let didPrintDashboard = false;\n        for (const [script, workerState] of Object.entries(allWorkerStates)) {\n            if (!workerState.state) {\n                continue;\n            }\n            const dotLength = 34 - script.length;\n            const dots = colors.dim(''.padEnd(dotLength, '.'));\n            const [fmt, stateString] = getStateString(workerState, !!devMode);\n            process.stdout.write(`  ${script}${dots}[${fmt(stateString)}]\\n`);\n            didPrintDashboard = true;\n        }\n        if (didPrintDashboard) {\n            process.stdout.write('\\n');\n        }\n        process.stdout.write('\\n');\n        if (isInstalling) {\n            process.stdout.write(`${colors.underline(colors.bold('â¼ snowpack install'))}\\n\\n`);\n            process.stdout.write('  ' + installOutput.trim().replace(/\\n/gm, '\\n  '));\n            process.stdout.write('\\n\\n');\n            return;\n        }\n        if (missingWebModule) {\n            const { id, pkgName, spec } = missingWebModule;\n            process.stdout.write(`${colors.red(colors.underline(colors.bold('â¼ Snowpack')))}\\n\\n`);\n            if (devMode) {\n                process.stdout.write(`  Package ${colors.bold(pkgName)} not found!\\n`);\n                process.stdout.write(colors.dim(`  in ${id}`));\n                process.stdout.write(`\\n\\n`);\n                process.stdout.write(`  ${colors.bold('Press Enter')} to automatically run ${colors.bold(isYarn(cwd) ? `yarn add ${pkgName}` : `npm install --save ${pkgName}`)}.\\n`);\n                process.stdout.write(`  Or, Exit Snowpack and install manually to continue.\\n`);\n            }\n            else {\n                process.stdout.write(`  Dependency ${colors.bold(spec)} not found!\\n\\n`);\n                // process.stdout.write(\n                //   `  Run ${colors.bold('snowpack install')} to install all required dependencies.\\n\\n`,\n                // );\n                process.exit(1);\n            }\n            return;\n        }\n        for (const [script, workerState] of Object.entries(allWorkerStates)) {\n            if (workerState.output) {\n                const colorsFn = Array.isArray(workerState.error) ? colors.red : colors.reset;\n                process.stdout.write(`${colorsFn(colors.underline(colors.bold('â¼ ' + script)))}\\n\\n`);\n                process.stdout.write(workerState.output\n                    ? '  ' + workerState.output.trim().replace(/\\n/gm, '\\n  ')\n                    : hasBeenCleared\n                        ? colors.dim('  Output cleared.')\n                        : colors.dim('  No output, yet.'));\n                process.stdout.write('\\n\\n');\n            }\n        }\n        if (consoleOutput) {\n            process.stdout.write(`${colors.underline(colors.bold('â¼ Console'))}\\n\\n`);\n            process.stdout.write(consoleOutput\n                ? '  ' + consoleOutput.trim().replace(/\\n/gm, '\\n  ')\n                : hasBeenCleared\n                    ? colors.dim('  Output cleared.')\n                    : colors.dim('  No output, yet.'));\n            process.stdout.write('\\n\\n');\n        }\n        const overallStatus = Object.values(allWorkerStates).reduce((result, { done, error }) => {\n            return {\n                done: result.done && done,\n                error: result.error || error,\n            };\n        });\n        if (overallStatus.error) {\n            process.stdout.write(`${colors.underline(colors.red(colors.bold('â¼ Result')))}\\n\\n`);\n            process.stdout.write('  â ï¸  Finished, with errors.');\n            process.stdout.write('\\n\\n');\n            process.exit(1);\n        }\n    }\n    bus.on('BUILD_FILE', ({ id, isBuilding }) => {\n        if (isBuilding) {\n            allFileBuilds.add(path.relative(cwd, id));\n        }\n        else {\n            allFileBuilds.delete(path.relative(cwd, id));\n        }\n        repaint();\n    });\n    bus.on('WORKER_START', ({ id, state }) => {\n        setupWorker(id);\n        allWorkerStates[id].state = state || ['RUNNING', 'yellow'];\n        repaint();\n    });\n    bus.on('WORKER_MSG', ({ id, msg }) => {\n        setupWorker(id);\n        allWorkerStates[id].output += msg;\n        repaint();\n    });\n    bus.on('WORKER_UPDATE', ({ id, state }) => {\n        if (typeof state !== undefined) {\n            setupWorker(id);\n            allWorkerStates[id].state = state;\n        }\n        repaint();\n    });\n    bus.on('WORKER_COMPLETE', ({ id, error }) => {\n        allWorkerStates[id].state = ['DONE', 'green'];\n        allWorkerStates[id].done = true;\n        allWorkerStates[id].error = allWorkerStates[id].error || error;\n        repaint();\n    });\n    bus.on('WORKER_RESET', ({ id }) => {\n        allWorkerStates[id] = { ...WORKER_BASE_STATE };\n        repaint();\n    });\n    bus.on('CONSOLE', ({ level, args }) => {\n        if (isInstalling) {\n            const msg = util.format.apply(util, args);\n            if (!msg.startsWith('[404] ')) {\n                installOutput += msg;\n            }\n        }\n        else {\n            consoleOutput += `[${level}] ${util.format.apply(util, args)}\\n`;\n        }\n        repaint();\n    });\n    bus.on('NEW_SESSION', () => {\n        if (consoleOutput) {\n            consoleOutput = ``;\n            hasBeenCleared = true;\n        }\n        // Reset all per-file build scripts\n        for (const script of scripts) {\n            if (script.startsWith('build')) {\n                setupWorker(script);\n                allWorkerStates[script] = {\n                    ...WORKER_BASE_STATE,\n                };\n            }\n        }\n        repaint();\n    });\n    bus.on('INSTALLING', () => {\n        isInstalling = true;\n        installOutput = '';\n        repaint();\n    });\n    bus.on('INSTALL_COMPLETE', () => {\n        setTimeout(() => {\n            missingWebModule = null;\n            isInstalling = false;\n            installOutput = '';\n            consoleOutput = ``;\n            hasBeenCleared = true;\n            repaint();\n        }, 2000);\n    });\n    bus.on('MISSING_WEB_MODULE', ({ id, data }) => {\n        if (!missingWebModule && data) {\n            missingWebModule = { id, ...data };\n        }\n        if (missingWebModule && missingWebModule.id === id) {\n            if (!data) {\n                missingWebModule = null;\n            }\n            else {\n                missingWebModule = { id, ...data };\n            }\n        }\n        repaint();\n    });\n    bus.on('SERVER_START', (info) => {\n        startTimeMs = info.startTimeMs;\n        hostname = info.hostname;\n        port = info.port;\n        protocol = info.protocol;\n        ips = info.ips;\n        repaint();\n    });\n    if (devMode) {\n        readline.emitKeypressEvents(process.stdin);\n        process.stdin.on('keypress', (_, key) => {\n            if (key.name !== 'return' && key.name !== 'enter') {\n                return;\n            }\n            if (!missingWebModule) {\n                return;\n            }\n            devMode.addPackage(missingWebModule.pkgName);\n            repaint();\n        });\n    }\n    repaint();\n}\n","/**\n * This license applies to parts of this file originating from the\n * https://github.com/lukejacksonn/servor repository:\n *\n * MIT License\n * Copyright (c) 2019 Luke Jackson\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\nimport cacache from 'cacache';\nimport isCompressible from 'compressible';\nimport merge from 'deepmerge';\nimport etag from 'etag';\nimport { EventEmitter } from 'events';\nimport execa from 'execa';\nimport { existsSync, promises as fs, readFileSync } from 'fs';\nimport http from 'http';\nimport HttpProxy from 'http-proxy';\nimport http2 from 'http2';\nimport https from 'https';\nimport * as colors from 'kleur/colors';\nimport mime from 'mime-types';\nimport npmRunPath from 'npm-run-path';\nimport os from 'os';\nimport path from 'path';\nimport onProcessExit from 'signal-exit';\nimport stream from 'stream';\nimport url from 'url';\nimport zlib from 'zlib';\nimport { generateEnvModule, getMetaUrlPath, wrapHtmlResponse, wrapImportMeta, wrapImportProxy, } from '../build/build-import-proxy';\nimport { buildFile as _buildFile, getInputsFromOutput } from '../build/build-pipeline';\nimport { createImportResolver } from '../build/import-resolver';\nimport srcFileExtensionMapping from '../build/src-file-extension-mapping';\nimport { EsmHmrEngine } from '../hmr-server-engine';\nimport { scanCodeImportsExports, transformEsmImports, transformFileImports, } from '../rewrite-imports';\nimport { BUILD_CACHE, checkLockfileHash, DEV_DEPENDENCIES_DIR, getEncodingType, getExt, isYarn, openInBrowser, parsePackageImportSpecifier, replaceExt, resolveDependencyManifest, updateLockfileHash, } from '../util';\nimport { command as installCommand } from './install';\nimport { getPort, paint } from './paint';\nconst HMR_DEV_CODE = readFileSync(path.join(__dirname, '../assets/hmr.js'));\nconst DEFAULT_PROXY_ERROR_HANDLER = (err, req, res) => {\n    const reqUrl = req.url;\n    console.error(`â ${reqUrl}\\n${err.message}`);\n    sendError(req, res, 502);\n};\nfunction shouldProxy(pathPrefix, req) {\n    const reqPath = decodeURI(url.parse(req.url).pathname);\n    return reqPath.startsWith(pathPrefix);\n}\nconst sendFile = (req, res, body, ext = '.html') => {\n    const ETag = etag(body, { weak: true });\n    const contentType = mime.contentType(ext);\n    const headers = {\n        'Content-Type': contentType || 'application/octet-stream',\n        'Access-Control-Allow-Origin': '*',\n        ETag,\n        Vary: 'Accept-Encoding',\n    };\n    if (req.headers['if-none-match'] === ETag) {\n        res.writeHead(304, headers);\n        res.end();\n        return;\n    }\n    let acceptEncoding = req.headers['accept-encoding'] || '';\n    if (req.headers['cache-control']?.includes('no-transform') ||\n        ['HEAD', 'OPTIONS'].includes(req.method) ||\n        !contentType ||\n        !isCompressible(contentType)) {\n        acceptEncoding = '';\n    }\n    function onError(err) {\n        if (err) {\n            res.end();\n            console.error(colors.red(`  â An error occurred while compressing ${colors.bold(req.url)}`), err);\n        }\n    }\n    if (/\\bgzip\\b/.test(acceptEncoding) && stream.Readable.from) {\n        const bodyStream = stream.Readable.from([body]);\n        headers['Content-Encoding'] = 'gzip';\n        res.writeHead(200, headers);\n        stream.pipeline(bodyStream, zlib.createGzip(), res, onError);\n        return;\n    }\n    res.writeHead(200, headers);\n    res.write(body, getEncodingType(ext));\n    res.end();\n};\nconst sendError = (req, res, status) => {\n    const contentType = mime.contentType(path.extname(req.url) || '.html');\n    const headers = {\n        'Content-Type': contentType || 'application/octet-stream',\n        'Access-Control-Allow-Origin': '*',\n        Vary: 'Accept-Encoding',\n    };\n    res.writeHead(status, headers);\n    res.end();\n};\nfunction getUrlFromFile(mountedDirectories, fileLoc, config) {\n    for (const [dirDisk, dirUrl] of mountedDirectories) {\n        if (fileLoc.startsWith(dirDisk + path.sep)) {\n            const { baseExt } = getExt(fileLoc);\n            const resolvedDirUrl = dirUrl === '/' ? '' : dirUrl;\n            return replaceExt(fileLoc.replace(dirDisk, resolvedDirUrl).replace(/[/\\\\]+/g, '/'), config._extensionMap[baseExt] || srcFileExtensionMapping[baseExt] || baseExt);\n        }\n    }\n    return null;\n}\nlet currentlyRunningCommand = null;\nexport async function command(commandOptions) {\n    const { cwd, config } = commandOptions;\n    const { port: defaultPort, hostname, open, hmr: isHmr } = config.devOptions;\n    // Start the startup timer!\n    let serverStart = Date.now();\n    const port = await getPort(defaultPort);\n    // Reset the clock if we had to wait for the user to select a new port.\n    if (port !== defaultPort) {\n        serverStart = Date.now();\n    }\n    const inMemoryBuildCache = new Map();\n    const filesBeingDeleted = new Set();\n    const filesBeingBuilt = new Map();\n    const messageBus = new EventEmitter();\n    const mountedDirectories = Object.entries(config.mount).map(([fromDisk, toUrl]) => {\n        return [path.resolve(cwd, fromDisk), toUrl];\n    });\n    console.log = (...args) => {\n        messageBus.emit('CONSOLE', { level: 'log', args });\n    };\n    console.warn = (...args) => {\n        messageBus.emit('CONSOLE', { level: 'warn', args });\n    };\n    console.error = (...args) => {\n        messageBus.emit('CONSOLE', { level: 'error', args });\n    };\n    // Start painting immediately, so we can surface errors & warnings to the\n    // user, and they can watch the server starting up. Search for âSERVER_STARTâ\n    // for the actual start event below.\n    paint(messageBus, config.plugins.map((p) => p.name), undefined, {\n        addPackage: async (pkgName) => {\n            isLiveReloadPaused = true;\n            messageBus.emit('INSTALLING');\n            currentlyRunningCommand = execa(isYarn(cwd) ? 'yarn' : 'npm', isYarn(cwd) ? ['add', pkgName] : ['install', '--save', pkgName], {\n                env: npmRunPath.env(),\n                extendEnv: true,\n                shell: true,\n                cwd,\n            });\n            currentlyRunningCommand.stdout.on('data', (data) => process.stdout.write(data));\n            currentlyRunningCommand.stderr.on('data', (data) => process.stderr.write(data));\n            await currentlyRunningCommand;\n            currentlyRunningCommand = installCommand(installCommandOptions);\n            await currentlyRunningCommand;\n            await updateLockfileHash(DEV_DEPENDENCIES_DIR);\n            await cacache.rm.all(BUILD_CACHE);\n            inMemoryBuildCache.clear();\n            currentlyRunningCommand = null;\n            dependencyImportMap = JSON.parse(await fs\n                .readFile(dependencyImportMapLoc, { encoding: 'utf-8' })\n                .catch(() => `{\"imports\": {}}`));\n            messageBus.emit('INSTALL_COMPLETE');\n            isLiveReloadPaused = false;\n        },\n    });\n    // Set the proper install options, in case an install is needed.\n    const dependencyImportMapLoc = path.join(DEV_DEPENDENCIES_DIR, 'import-map.json');\n    const installCommandOptions = merge(commandOptions, {\n        config: {\n            installOptions: {\n                dest: DEV_DEPENDENCIES_DIR,\n                env: { NODE_ENV: process.env.NODE_ENV || 'development' },\n                treeshake: false,\n            },\n        },\n    });\n    // Start with a fresh install of your dependencies, if needed.\n    if (!(await checkLockfileHash(DEV_DEPENDENCIES_DIR)) || !existsSync(dependencyImportMapLoc)) {\n        console.log(colors.yellow('! updating dependencies...'));\n        await installCommand(installCommandOptions);\n        await updateLockfileHash(DEV_DEPENDENCIES_DIR);\n    }\n    let dependencyImportMap = { imports: {} };\n    try {\n        dependencyImportMap = JSON.parse(await fs.readFile(dependencyImportMapLoc, { encoding: 'utf-8' }));\n    }\n    catch (err) {\n        // no import-map found, safe to ignore\n    }\n    /** Rerun `snowpack install` while dev server is running */\n    async function reinstallDependencies() {\n        if (!currentlyRunningCommand) {\n            isLiveReloadPaused = true;\n            messageBus.emit('INSTALLING');\n            currentlyRunningCommand = installCommand(installCommandOptions);\n            await currentlyRunningCommand.then(async () => {\n                dependencyImportMap = JSON.parse(await fs\n                    .readFile(dependencyImportMapLoc, { encoding: 'utf-8' })\n                    .catch(() => `{\"imports\": {}}`));\n                await updateLockfileHash(DEV_DEPENDENCIES_DIR);\n                await cacache.rm.all(BUILD_CACHE);\n                inMemoryBuildCache.clear();\n                messageBus.emit('INSTALL_COMPLETE');\n                isLiveReloadPaused = false;\n                currentlyRunningCommand = null;\n            });\n        }\n    }\n    const devProxies = {};\n    config.proxy.forEach(([pathPrefix, proxyOptions]) => {\n        const proxyServer = (devProxies[pathPrefix] = HttpProxy.createProxyServer(proxyOptions));\n        for (const [onEventName, eventHandler] of Object.entries(proxyOptions.on)) {\n            proxyServer.on(onEventName, eventHandler);\n        }\n        if (!proxyOptions.on.error) {\n            proxyServer.on('error', DEFAULT_PROXY_ERROR_HANDLER);\n        }\n    });\n    const readCredentials = async (cwd) => {\n        const [cert, key] = await Promise.all([\n            fs.readFile(path.join(cwd, 'snowpack.crt')),\n            fs.readFile(path.join(cwd, 'snowpack.key')),\n        ]);\n        return {\n            cert,\n            key,\n        };\n    };\n    let credentials;\n    if (config.devOptions.secure) {\n        try {\n            credentials = await readCredentials(cwd);\n        }\n        catch (e) {\n            console.error(colors.red(`â No HTTPS credentials found! Missing Files:  ${colors.bold('snowpack.crt')}, ${colors.bold('snowpack.key')}`));\n            console.log();\n            console.log('You can automatically generate credentials for your project via either:');\n            console.log();\n            console.log(`  - ${colors.cyan('devcert')}: ${colors.yellow('npx devcert-cli generate localhost')}`);\n            console.log('    https://github.com/davewasmer/devcert-cli (no install required)');\n            console.log();\n            console.log(`  - ${colors.cyan('mkcert')}: ${colors.yellow('mkcert -install && mkcert -key-file snowpack.key -cert-file snowpack.crt localhost')}`);\n            console.log('    https://github.com/FiloSottile/mkcert (install required)');\n            console.log();\n            process.exit(1);\n        }\n    }\n    for (const runPlugin of config.plugins) {\n        if (runPlugin.run) {\n            messageBus.emit('WORKER_START', { id: runPlugin.name });\n            runPlugin\n                .run({\n                isDev: true,\n                isHmrEnabled: isHmr,\n                // @ts-ignore: internal API only\n                log: (msg, data) => {\n                    messageBus.emit(msg, { ...data, id: runPlugin.name });\n                },\n            })\n                .then(() => {\n                messageBus.emit('WORKER_COMPLETE', { id: runPlugin.name, error: null });\n            })\n                .catch((err) => {\n                messageBus.emit('WORKER_COMPLETE', { id: runPlugin.name, error: err });\n            });\n        }\n    }\n    async function requestHandler(req, res) {\n        const reqUrl = req.url;\n        const reqUrlHmrParam = reqUrl.includes('?mtime=') && reqUrl.split('?')[1];\n        let reqPath = decodeURI(url.parse(reqUrl).pathname);\n        const originalReqPath = reqPath;\n        let isProxyModule = false;\n        if (reqPath.endsWith('.proxy.js')) {\n            isProxyModule = true;\n            reqPath = reqPath.replace('.proxy.js', '');\n        }\n        // const requestStart = Date.now();\n        res.on('finish', () => {\n            const { method, url } = req;\n            const { statusCode } = res;\n            if (statusCode !== 200) {\n                messageBus.emit('SERVER_RESPONSE', {\n                    method,\n                    url,\n                    statusCode,\n                });\n            }\n        });\n        if (reqPath === getMetaUrlPath('/hmr.js', true, config)) {\n            sendFile(req, res, HMR_DEV_CODE, '.js');\n            return;\n        }\n        if (reqPath === getMetaUrlPath('/env.js', true, config)) {\n            sendFile(req, res, generateEnvModule('development'), '.js');\n            return;\n        }\n        for (const [pathPrefix] of config.proxy) {\n            if (!shouldProxy(pathPrefix, req)) {\n                continue;\n            }\n            devProxies[pathPrefix].web(req, res);\n            return;\n        }\n        const attemptedFileLoads = [];\n        function attemptLoadFile(requestedFile) {\n            if (attemptedFileLoads.includes(requestedFile)) {\n                return Promise.resolve(null);\n            }\n            attemptedFileLoads.push(requestedFile);\n            return fs\n                .stat(requestedFile)\n                .then((stat) => (stat.isFile() ? requestedFile : null))\n                .catch(() => null /* ignore */);\n        }\n        let requestedFileExt = path.parse(reqPath).ext.toLowerCase();\n        let responseFileExt = requestedFileExt;\n        let isRoute = !requestedFileExt || requestedFileExt === '.html';\n        // Now that we've set isRoute properly, give `requestedFileExt` a fallback\n        requestedFileExt = requestedFileExt || '.html';\n        async function getFileFromUrl(reqPath) {\n            if (reqPath.startsWith(config.buildOptions.webModulesUrl)) {\n                const fileLoc = await attemptLoadFile(reqPath.replace(config.buildOptions.webModulesUrl, DEV_DEPENDENCIES_DIR));\n                if (fileLoc) {\n                    return fileLoc;\n                }\n            }\n            for (const [dirDisk, dirUrl] of mountedDirectories) {\n                let requestedFile;\n                if (dirUrl === '/') {\n                    requestedFile = path.join(dirDisk, reqPath);\n                }\n                else if (reqPath.startsWith(dirUrl)) {\n                    requestedFile = path.join(dirDisk, reqPath.replace(dirUrl, './'));\n                }\n                else {\n                    continue;\n                }\n                if (isRoute) {\n                    let fileLoc = (await attemptLoadFile(requestedFile + '.html')) ||\n                        (await attemptLoadFile(requestedFile + 'index.html')) ||\n                        (await attemptLoadFile(requestedFile + '/index.html'));\n                    if (!fileLoc && dirUrl === '/' && config.devOptions.fallback) {\n                        const fallbackFile = path.join(dirDisk, config.devOptions.fallback);\n                        fileLoc = await attemptLoadFile(fallbackFile);\n                    }\n                    if (fileLoc) {\n                        responseFileExt = '.html';\n                        return fileLoc;\n                    }\n                }\n                else {\n                    for (const potentialSourceFile of getInputsFromOutput(requestedFile, config.plugins)) {\n                        const fileLoc = await attemptLoadFile(potentialSourceFile);\n                        if (fileLoc) {\n                            return fileLoc;\n                        }\n                    }\n                }\n            }\n            return null;\n        }\n        const fileLoc = await getFileFromUrl(reqPath);\n        if (isRoute) {\n            messageBus.emit('NEW_SESSION');\n        }\n        if (!fileLoc) {\n            const prefix = colors.red('  â ');\n            console.error(`[404] ${reqUrl}\\n${attemptedFileLoads.map((loc) => prefix + loc).join('\\n')}`);\n            return sendError(req, res, 404);\n        }\n        /**\n         * Given a file, build it. Building a file sends it through our internal file builder\n         * pipeline, and outputs a build map representing the final build. A Build Map is used\n         * because one source file can result in multiple built files (Example: .svelte -> .js & .css).\n         */\n        async function buildFile(fileLoc) {\n            const existingBuilderPromise = filesBeingBuilt.get(fileLoc);\n            if (existingBuilderPromise) {\n                return existingBuilderPromise;\n            }\n            const fileBuilderPromise = (async () => {\n                const builtFileOutput = await _buildFile(fileLoc, {\n                    plugins: config.plugins,\n                    messageBus,\n                    isDev: true,\n                    isHmrEnabled: isHmr,\n                });\n                inMemoryBuildCache.set(fileLoc, builtFileOutput);\n                return builtFileOutput;\n            })();\n            filesBeingBuilt.set(fileLoc, fileBuilderPromise);\n            try {\n                messageBus.emit('BUILD_FILE', { id: fileLoc, isBuilding: true });\n                return await fileBuilderPromise;\n            }\n            finally {\n                filesBeingBuilt.delete(fileLoc);\n                messageBus.emit('BUILD_FILE', { id: fileLoc, isBuilding: false });\n            }\n        }\n        /**\n         * Wrap Response: The same build result can be expressed in different ways based on\n         * the URL. For example, \"App.css\" should return CSS but \"App.css.proxy.js\" should\n         * return a JS representation of that CSS. This is handled in the wrap step.\n         */\n        async function wrapResponse(code, hasCssResource) {\n            if (isRoute) {\n                code = wrapHtmlResponse({ code: code, isDev: true, hmr: isHmr, config });\n            }\n            else if (isProxyModule) {\n                responseFileExt = '.js';\n                code = await wrapImportProxy({\n                    url: reqPath,\n                    code,\n                    isDev: true,\n                    hmr: isHmr,\n                    config,\n                });\n            }\n            else if (responseFileExt === '.js') {\n                code = wrapImportMeta({ code, env: true, isDev: true, hmr: isHmr, config });\n            }\n            if (responseFileExt === '.js' && hasCssResource) {\n                code = `import './${path.basename(reqPath).replace(/.js$/, '.css.proxy.js')}';\\n` + code;\n            }\n            if (responseFileExt === '.js' && reqUrlHmrParam) {\n                code = await transformEsmImports(code, (imp) => {\n                    const importUrl = path.posix.resolve(path.posix.dirname(reqPath), imp);\n                    const node = hmrEngine.getEntry(importUrl);\n                    if (node && node.needsReplacement) {\n                        hmrEngine.markEntryForReplacement(node, false);\n                        return `${imp}?${reqUrlHmrParam}`;\n                    }\n                    return imp;\n                });\n            }\n            if (responseFileExt === '.js') {\n                const isHmrEnabled = code.includes('import.meta.hot');\n                const rawImports = await scanCodeImportsExports(code);\n                const resolvedImports = rawImports.map((imp) => {\n                    let spec = code.substring(imp.s, imp.e);\n                    if (imp.d > -1) {\n                        const importSpecifierMatch = spec.match(/^\\s*['\"](.*)['\"]\\s*$/m);\n                        spec = importSpecifierMatch[1];\n                    }\n                    return path.posix.resolve(path.posix.dirname(reqPath), spec);\n                });\n                hmrEngine.setEntry(originalReqPath, resolvedImports, isHmrEnabled);\n            }\n            return code;\n        }\n        /**\n         * Resolve Imports: Resolved imports are based on the state of the file system, so\n         * they can't be cached long-term with the build.\n         */\n        async function resolveResponseImports(fileLoc, responseExt, wrappedResponse) {\n            let missingWebModule = null;\n            const resolveImportSpecifier = createImportResolver({\n                fileLoc,\n                dependencyImportMap,\n                config,\n            });\n            wrappedResponse = await transformFileImports({\n                locOnDisk: fileLoc,\n                contents: wrappedResponse,\n                baseExt: responseExt,\n                expandedExt: getExt(fileLoc).expandedExt,\n            }, (spec) => {\n                // Try to resolve the specifier to a known URL in the project\n                const resolvedImportUrl = resolveImportSpecifier(spec);\n                if (resolvedImportUrl) {\n                    const extName = path.extname(resolvedImportUrl);\n                    if (extName && extName !== '.js') {\n                        return resolvedImportUrl + '.proxy.js';\n                    }\n                    return resolvedImportUrl;\n                }\n                // If that fails, return a placeholder import and attempt to resolve.\n                const [packageName] = parsePackageImportSpecifier(spec);\n                const [depManifestLoc] = resolveDependencyManifest(packageName, cwd);\n                const doesPackageExist = !!depManifestLoc;\n                if (doesPackageExist) {\n                    reinstallDependencies();\n                }\n                else {\n                    missingWebModule = {\n                        spec: spec,\n                        pkgName: packageName,\n                    };\n                }\n                // Return a placeholder while Snowpack goes out and tries to re-install (or warn)\n                // on the missing package.\n                return spec;\n            });\n            messageBus.emit('MISSING_WEB_MODULE', {\n                id: fileLoc,\n                data: missingWebModule,\n            });\n            return wrappedResponse;\n        }\n        /**\n         * Given a build, finalize it for the response. This involves running individual steps\n         * needed to go from build result to sever response, including:\n         *   - wrapResponse(): Wrap responses\n         *   - resolveResponseImports(): Resolve all ESM imports\n         */\n        async function finalizeResponse(fileLoc, requestedFileExt, output) {\n            // Verify that the requested file exists in the build output map.\n            if (!output[requestedFileExt] || !Object.keys(output)) {\n                return null;\n            }\n            // Wrap the response.\n            const hasAttachedCss = requestedFileExt === '.js' && !!output['.css'];\n            let wrappedResponse = await wrapResponse(output[requestedFileExt], hasAttachedCss);\n            // Resolve imports.\n            if (requestedFileExt === '.js' || requestedFileExt === '.html') {\n                wrappedResponse = await resolveResponseImports(fileLoc, requestedFileExt, wrappedResponse);\n            }\n            // Return the finalized response.\n            return wrappedResponse;\n        }\n        // 1. Check the hot build cache. If it's already found, then just serve it.\n        let hotCachedResponse = inMemoryBuildCache.get(fileLoc);\n        if (hotCachedResponse) {\n            const responseContent = await finalizeResponse(fileLoc, requestedFileExt, hotCachedResponse);\n            if (!responseContent) {\n                sendError(req, res, 404);\n                return;\n            }\n            sendFile(req, res, responseContent, responseFileExt);\n            return;\n        }\n        // 2. Load the file from disk. We'll need it to check the cold cache or build from scratch.\n        const fileContents = await fs.readFile(fileLoc, getEncodingType(requestedFileExt));\n        // 3. Send dependencies directly, since they were already build & resolved at install time.\n        if (reqPath.startsWith(config.buildOptions.webModulesUrl)) {\n            sendFile(req, res, fileContents, responseFileExt);\n            return;\n        }\n        // 4. Check the persistent cache. If found, serve it via a \"trust-but-verify\" strategy.\n        // Build it after sending, and if it no longer matches then assume the entire cache is suspect.\n        // In that case, clear the persistent cache and then force a live-reload of the page.\n        const cachedBuildData = !filesBeingDeleted.has(fileLoc) &&\n            (await cacache.get(BUILD_CACHE, fileLoc).catch(() => null));\n        if (cachedBuildData) {\n            const { originalFileHash } = cachedBuildData.metadata;\n            const newFileHash = etag(fileContents);\n            if (originalFileHash === newFileHash) {\n                const coldCachedResponse = JSON.parse(cachedBuildData.data.toString());\n                inMemoryBuildCache.set(fileLoc, coldCachedResponse);\n                // Trust...\n                const wrappedResponse = await finalizeResponse(fileLoc, requestedFileExt, coldCachedResponse);\n                if (!wrappedResponse) {\n                    sendError(req, res, 404);\n                    return;\n                }\n                sendFile(req, res, wrappedResponse, responseFileExt);\n                // ...but verify.\n                let checkFinalBuildResult = null;\n                try {\n                    checkFinalBuildResult = await buildFile(fileLoc);\n                }\n                catch (err) {\n                    // safe to ignore, it will be surfaced later anyway\n                }\n                finally {\n                    if (!checkFinalBuildResult ||\n                        !cachedBuildData.data.equals(Buffer.from(JSON.stringify(checkFinalBuildResult)))) {\n                        inMemoryBuildCache.clear();\n                        await cacache.rm.all(BUILD_CACHE);\n                        hmrEngine.broadcastMessage({ type: 'reload' });\n                    }\n                }\n                return;\n            }\n        }\n        // 5. Final option: build the file, serve it, and cache it.\n        let responseContent;\n        let responseOutput;\n        try {\n            responseOutput = await buildFile(fileLoc);\n        }\n        catch (err) {\n            sendError(req, res, 500);\n            return;\n        }\n        try {\n            responseContent = await finalizeResponse(fileLoc, requestedFileExt, responseOutput);\n        }\n        catch (err) {\n            console.error(reqPath, err);\n            sendError(req, res, 500);\n            return;\n        }\n        if (!responseContent) {\n            sendError(req, res, 404);\n            return;\n        }\n        sendFile(req, res, responseContent, responseFileExt);\n        const originalFileHash = etag(fileContents);\n        cacache.put(BUILD_CACHE, fileLoc, Buffer.from(JSON.stringify(responseOutput)), {\n            metadata: { originalFileHash },\n        });\n    }\n    const createServer = (requestHandler) => {\n        if (credentials && config.proxy.length === 0) {\n            return http2.createSecureServer({ ...credentials, allowHTTP1: true }, requestHandler);\n        }\n        else if (credentials) {\n            return https.createServer(credentials, requestHandler);\n        }\n        return http.createServer(requestHandler);\n    };\n    const server = createServer(async (req, res) => {\n        try {\n            return await requestHandler(req, res);\n        }\n        catch (err) {\n            console.error(`[500] ${req.url}`);\n            console.error(err);\n            return sendError(req, res, 500);\n        }\n    })\n        .on('error', (err) => {\n        console.error(colors.red(`  â Failed to start server at port ${colors.bold(port)}.`), err);\n        server.close();\n        process.exit(1);\n    })\n        .on('upgrade', (req, socket, head) => {\n        config.proxy.forEach(([pathPrefix, proxyOptions]) => {\n            const isWebSocket = proxyOptions.ws || proxyOptions.target?.toString().startsWith('ws');\n            if (isWebSocket && shouldProxy(pathPrefix, req)) {\n                devProxies[pathPrefix].ws(req, socket, head);\n                console.log('Upgrading to WebSocket');\n            }\n        });\n    })\n        .listen(port);\n    const hmrEngine = new EsmHmrEngine({ server });\n    onProcessExit(() => {\n        hmrEngine.disconnectAllClients();\n    });\n    // Live Reload + File System Watching\n    let isLiveReloadPaused = false;\n    function updateOrBubble(url, visited) {\n        if (visited.has(url)) {\n            return;\n        }\n        visited.add(url);\n        const node = hmrEngine.getEntry(url);\n        if (node && node.isHmrEnabled) {\n            hmrEngine.broadcastMessage({ type: 'update', url });\n        }\n        if (node && node.isHmrAccepted) {\n            // Found a boundary, no bubbling needed\n        }\n        else if (node && node.dependents.size > 0) {\n            hmrEngine.markEntryForReplacement(node, true);\n            node.dependents.forEach((dep) => updateOrBubble(dep, visited));\n        }\n        else {\n            // We've reached the top, trigger a full page refresh\n            hmrEngine.broadcastMessage({ type: 'reload' });\n        }\n    }\n    function handleHmrUpdate(fileLoc) {\n        if (isLiveReloadPaused) {\n            return;\n        }\n        let updateUrl = getUrlFromFile(mountedDirectories, fileLoc, config);\n        if (!updateUrl) {\n            return;\n        }\n        // Append \".proxy.js\" to Non-JS files to match their registered URL in the client app.\n        if (!updateUrl.endsWith('.js') && !updateUrl.endsWith('.module.css')) {\n            updateUrl += '.proxy.js';\n        }\n        // Check if a virtual file exists in the resource cache (ex: CSS from a Svelte file)\n        // If it does, mark it for HMR replacement but DONT trigger a separate HMR update event.\n        // This is because a virtual resource doesn't actually exist on disk, so we need the main\n        // resource (the JS) to load first. Only after that happens will the CSS exist.\n        const virtualCssFileUrl = updateUrl.replace(/.js$/, '.css');\n        const virtualNode = hmrEngine.getEntry(`${virtualCssFileUrl}.proxy.js`);\n        if (virtualNode) {\n            hmrEngine.markEntryForReplacement(virtualNode, true);\n        }\n        // If the changed file exists on the page, trigger a new HMR update.\n        if (hmrEngine.getEntry(updateUrl)) {\n            updateOrBubble(updateUrl, new Set());\n            return;\n        }\n        // Otherwise, reload the page if the file exists in our hot cache (which means that the\n        // file likely exists on the current page, but is not supported by HMR (HTML, image, etc)).\n        if (inMemoryBuildCache.has(fileLoc)) {\n            hmrEngine.broadcastMessage({ type: 'reload' });\n            return;\n        }\n    }\n    // Announce server has started\n    const ips = Object.values(os.networkInterfaces())\n        .reduce((every, i) => [...every, ...(i || [])], [])\n        .filter((i) => i.family === 'IPv4' && i.internal === false)\n        .map((i) => i.address);\n    const protocol = config.devOptions.secure ? 'https:' : 'http:';\n    messageBus.emit('SERVER_START', {\n        protocol,\n        hostname,\n        port,\n        ips,\n        startTimeMs: Date.now() - serverStart,\n    });\n    // Open the user's browser\n    if (open !== 'none')\n        await openInBrowser(protocol, hostname, port, open);\n    // Start watching the file system.\n    // Defer \"chokidar\" loading to here, to reduce impact on overall startup time\n    const chokidar = await import('chokidar');\n    // Watch src files\n    async function onWatchEvent(fileLoc) {\n        handleHmrUpdate(fileLoc);\n        inMemoryBuildCache.delete(fileLoc);\n        filesBeingDeleted.add(fileLoc);\n        await cacache.rm.entry(BUILD_CACHE, fileLoc);\n        filesBeingDeleted.delete(fileLoc);\n    }\n    const watcher = chokidar.watch(mountedDirectories.map(([dirDisk]) => dirDisk), {\n        ignored: config.exclude,\n        persistent: true,\n        ignoreInitial: true,\n        disableGlobbing: false,\n    });\n    watcher.on('add', (fileLoc) => onWatchEvent(fileLoc));\n    watcher.on('change', (fileLoc) => onWatchEvent(fileLoc));\n    watcher.on('unlink', (fileLoc) => onWatchEvent(fileLoc));\n    // Watch node_modules & rerun snowpack install if symlinked dep updates\n    const symlinkedFileLocs = new Set(Object.keys(dependencyImportMap.imports)\n        .map((specifier) => {\n        const [packageName] = parsePackageImportSpecifier(specifier);\n        return resolveDependencyManifest(packageName, cwd);\n    }) // resolve symlink src location\n        .filter(([_, packageManifest]) => packageManifest && !packageManifest['_id']) // only watch symlinked deps for now\n        .map(([fileLoc]) => `${path.dirname(fileLoc)}/**`));\n    function onDepWatchEvent() {\n        reinstallDependencies().then(() => hmrEngine.broadcastMessage({ type: 'reload' }));\n    }\n    const depWatcher = chokidar.watch([...symlinkedFileLocs], {\n        cwd: '/',\n        persistent: true,\n        ignoreInitial: true,\n        disableGlobbing: false,\n    });\n    depWatcher.on('add', onDepWatchEvent);\n    depWatcher.on('change', onDepWatchEvent);\n    depWatcher.on('unlink', onDepWatchEvent);\n    return new Promise(() => { });\n}\n","import * as colors from 'kleur/colors';\nimport path from 'path';\nimport yargs from 'yargs-parser';\nimport { addCommand, rmCommand } from './commands/add-rm';\nimport { command as buildCommand } from './commands/build';\nimport { command as devCommand } from './commands/dev';\nimport { command as installCommand } from './commands/install';\nimport { loadAndValidateConfig } from './config.js';\nimport { clearCache, readLockfile } from './util.js';\nexport { install as unstable_installCommand } from './commands/install';\nexport { createConfiguration } from './config.js';\nexport * from './types/snowpack';\nconst cwd = process.cwd();\nfunction printHelp() {\n    console.log(`\n${colors.bold(`snowpack`)} - A faster build system for the modern web.\n\n  Snowpack is best configured via config file.\n  But, most configuration can also be passed via CLI flags.\n  ð ${colors.dim('https://www.snowpack.dev/#configuration')}\n\n${colors.bold('Commands:')}\n  snowpack dev          Develop your app locally.\n  snowpack build        Build your app for production.\n  snowpack install      (Advanced) Install web-ready dependencies.\n\n${colors.bold('Flags:')}\n  --config [path]       Set the location of your project config file.\n  --help                Show this help message.\n  --version             Show the current version.\n  --reload              Clear Snowpack's local cache (troubleshooting).\n    `.trim());\n}\nexport async function cli(args) {\n    // parse CLI flags\n    const cliFlags = yargs(args, {\n        array: ['install', 'env', 'exclude', 'externalPackage'],\n    });\n    if (cliFlags.help) {\n        printHelp();\n        process.exit(0);\n    }\n    if (cliFlags.version) {\n        console.log(require('../package.json').version);\n        process.exit(0);\n    }\n    if (cliFlags.reload) {\n        console.log(colors.yellow('! clearing cache...'));\n        await clearCache();\n    }\n    // Load the current package manifest\n    let pkgManifest;\n    try {\n        pkgManifest = require(path.join(cwd, 'package.json'));\n    }\n    catch (err) {\n        console.log(colors.red('[ERROR] package.json required but no file was found.'));\n        process.exit(1);\n    }\n    const cmd = cliFlags['_'][2];\n    // Set this early -- before config loading -- so that plugins see it.\n    if (cmd === 'build') {\n        process.env.NODE_ENV = process.env.NODE_ENV || 'production';\n    }\n    if (cmd === 'dev') {\n        process.env.NODE_ENV = process.env.NODE_ENV || 'development';\n    }\n    const commandOptions = {\n        cwd,\n        config: loadAndValidateConfig(cliFlags, pkgManifest),\n        lockfile: await readLockfile(cwd),\n        pkgManifest,\n    };\n    if (cmd === 'add') {\n        await addCommand(cliFlags['_'][3], commandOptions);\n        return;\n    }\n    if (cmd === 'rm') {\n        await rmCommand(cliFlags['_'][3], commandOptions);\n        return;\n    }\n    if (cliFlags['_'].length > 3) {\n        console.log(`Unexpected multiple commands`);\n        process.exit(1);\n    }\n    if (cmd === 'build') {\n        await buildCommand(commandOptions);\n        return;\n    }\n    if (cmd === 'dev') {\n        await devCommand(commandOptions);\n        return;\n    }\n    if (cmd === 'install' || !cmd) {\n        await installCommand(commandOptions);\n        return;\n    }\n    console.log(`Unrecognized command: ${cmd}`);\n    process.exit(1);\n}\n"],"names":["PIKA_CDN","GLOBAL_CACHE_DIR","globalCacheDir","RESOURCE_CACHE","path","join","BUILD_CACHE","PROJECT_CACHE_DIR","projectCacheDir","name","DEV_DEPENDENCIES_DIR","LOCKFILE_HASH_FILE","HAS_CDN_HASH_REGEX","HTML_JS_REGEX","URL_HAS_PROTOCOL_REGEX","isYarn","cwd","fs","existsSync","UTF8_FORMATS","getEncodingType","ext","includes","readLockfile","lockfileContents","readFileSync","encoding","err","JSON","parse","writeLockfile","loc","importMap","sortedImportMap","imports","key","Object","keys","sort","writeFileSync","stringify","undefined","fetchCDNResource","resourceUrl","responseType","startsWith","got","headers","throwHttpErrors","isTruthy","item","Boolean","parsePackageImportSpecifier","imp","impParts","split","scope","rest","resolveDependencyManifest","dep","depManifest","require","resolve","paths","code","result","fullPath","searchPath","sep","replace","indexOfSearch","lastIndexOf","manifestPath","substring","length","manifestStr","MISSING_PLUGIN_SUGGESTIONS","appNames","win32","brave","chrome","darwin","linux","openInBrowser","protocol","hostname","port","browser","url","test","process","platform","execa","command","shell","encodeURI","__dirname","stdio","open","app","checkLockfileHash","dir","lockfileLoc","findUp","hashLoc","newLockHash","etag","promises","readFile","oldLockHash","catch","updateLockfileHash","mkdirp","dirname","writeFile","clearCache","Promise","all","cacache","rm","rimraf","sync","findMatchingAliasEntry","config","spec","foundEntry","entries","alias","find","fromAlias","from","to","type","isPackageAliasEntry","val","isAbsolute","getExt","fileName","baseExt","extname","toLocaleLowerCase","expandedExt","basename","replaceExt","newExtension","replaceExpandedExt","extToReplace","RegExp","sanitizePackageName","filepath","dirs","file","pop","map","resolveDependency","installSpecifier","packageSemver","lockfile","canRetry","validatePackageName","validForNewPackages","installUrl","installUrlType","console","warn","Error","cachedResult","get","info","metadata","pinnedUrl","statusCode","body","importUrlPath","pinnedUrlPath","buildStatus","typesUrlPath","typesUrl","put","log","colors","lookupStatusCode","resolveTargetsFromRemoteCDN","downloadQueue","PQueue","concurrency","newLockfile","resolutionError","installSemver","webDependencies","add","resolvedUrl","onIdle","rollupPluginCatchUnresolved","resolveId","id","importer","isNodeBuiltin","message","FETCH_POLYFILL","rollupPluginCatchFetch","load","getInjectorCode","rollupPluginCss","source","endsWith","skipSelf","then","resolved","humanReadableName","CACHED_FILE_ID_PREFIX","PIKA_CDN_TRIM_LENGTH","rollupPluginDependencyCache","installTypes","allTypesToInstall","Set","cacheKey","response","packageName","finalResult","typesTarballUrl","data","toString","writeBundle","options","tempDir","tmp","mkdir","tarballContents","cachedTarball","tarballResponse","typesUrlParts","pathname","typesPackageName","typesPackageTarLoc","typesPackageLoc","tar","x","rollupPluginDependencyStats","cb","outputDir","existingFileCache","statsSummary","direct","common","buildExistingFileCache","bundle","filePath","size","statSync","compareDependencies","files","contents","byteLength","gzip","zlib","gzipSync","brotli","brotliCompressSync","delta","generateBundle","_","directDependencies","commonDependencies","assetOrChunk","raw","Buffer","isBuffer","push","autoDetectExports","fileLoc","error","rollupPluginWrapInstallTargets","isTreeshake","autoDetectPackageExports","installTargets","installTargetsByFile","isAutoDetect","normalizedFileLoc","some","p","inputOptions","input","filter","specifier","namespace","posix","treeshakeSummary","reduce","summary","default","named","uniqueNamedImports","Array","WEB_MODULES_TOKEN","WEB_MODULES_TOKEN_LENGTH","BARE_SPECIFIER_REGEX","ESM_IMPORT_REGEX","ESM_DYNAMIC_IMPORT_REGEX","HAS_NAMED_IMPORTS_REGEX","STRIP_AS","DEFAULT_IMPORT_REGEX","stripJsExtension","createInstallTarget","removeSpecifierQueryString","queryStringIndex","indexOf","getWebModuleSpecifierFromCode","d","s","e","importStatement","importSpecifierMatch","match","parseWebModuleSpecifier","cleanedSpecifier","webModulesIndex","resolvedSpecifier","resolvedSpecifierWithoutExtension","parseImportStatement","webModuleSpecifier","ss","se","isDynamicImport","hasDefaultImport","hasNamespaceImport","namedImports","trim","cleanCodeForParsing","stripComments","allMatches","importRegex","exec","dynamicImportRegex","full","parseCodeForInstallTargets","locOnDisk","allImports","scanDepList","depList","whitelistItem","glob","hasMagic","nodeModulesLoc","nodePath","nodir","flat","concat","scanImports","initESModuleLexer","includeFileSets","mount","fromDisk","dirDisk","ignore","exclude","absolute","includeFiles","apply","loadedFiles","regex","mime","lookup","relative","scanImportsFromFiles","target","aliasEntry","impA","impB","localeCompare","SIZE_COLUMN_WIDTH","entriesSort","filenameA","filenameB","formatSize","kb","Math","round","floor","color","padEnd","formatDelta","formatFileInfo","filename","stats","isLastFile","lineGlyph","lineName","fileStat","gzipStat","brotliStat","lineStat","lineDelta","formatFiles","strippedFiles","index","printStats","dependencyStats","output","allDirect","allCommon","maxFileNameLength","max","values","ErrorWithHint","constructor","hint","CJS_PACKAGES_TO_AUTO_DETECT","banner","spinner","spinnerHasError","installResults","defaultLogError","msg","stopAndPersist","symbol","ora","fail","defaultLogUpdate","text","formatInstallResults","isImportOfPackage","importUrl","getWebDependencyName","getRollupReplaceKeys","env","acc","NODE_ENV","resolveWebDependency","isJSFile","packageEntrypoint","packageManifestLoc","packageManifest","exports","exportMapEntry","exportMapValue","import","depManifestLoc","maybeLoc","foundEntrypoint","module","main","isImplicitEntrypoint","types","typings","FAILED_INSTALL_RETURN","success","install","logError","logUpdate","installAlias","installOptions","dest","destLoc","externalPackage","externalPackages","sourceMap","rollup","userDefinedRollup","treeshake","nodeModulesInstalled","versions","pnp","allInstallSpecifiers","installEntrypoints","assetEntrypoints","installTargetsMap","autoDetectNamedExports","namedExports","targetName","proxiedName","targetType","targetLoc","value","forEach","t","setTimeout","isCircularImportFound","external","moduleSideEffects","plugins","rollupPluginReplace","rollupPluginAlias","replacement","rollupPluginNodeResolve","mainFields","extensions","preferBuiltins","dedupe","rollupPluginJson","preferConst","indent","compact","rollupPluginCommonjs","externalEsm","EXTERNAL_ESM_PACKAGES","onwarn","warning","plugin","outputOptions","format","sourcemap","chunkFileNames","packageBundle","write","_err","errFilePath","failedExtension","suggestion","assetName","assetLoc","assetDest","copyFileSync","getInstallTargets","scannedFiles","knownEntrypoints","commandOptions","run","hasError","exit","installStart","performance","now","stop","installEnd","succeed","toFixed","addCommand","addValue","pkgManifest","pkgName","pkgSemver","json","version","installCommand","rmCommand","getMetaUrlPath","urlPath","isDev","baseUrl","metaDir","buildOptions","normalize","wrapImportMeta","hmr","wrapHtmlResponse","generateJsonImportProxy","jsonImportProxyCode","generateCssImportProxy","cssImportProxyCode","_cssModuleLoader","generateCssModuleImportProxy","injectableSource","exportTokens","generateDefaultImportProxy","wrapImportProxy","PUBLIC_ENV_REGEX","generateEnvModule","mode","envObject","MODE","esbuildService","IS_PREACT","checkIsPreact","getLoader","substr","esbuildPlugin","startService","isPreact","js","warnings","transform","loader","jsxFactory","jsxFragment","stopEsbuild","CONFIG_NAME","ALWAYS_EXCLUDE","DEFAULT_CONFIG","scripts","devOptions","secure","out","fallback","webModulesUrl","clean","minify","configSchema","properties","extends","items","additionalProperties","oneOf","enum","proxy","expandCliFlags","flags","relevantFlags","flag","parseScript","script","scriptType","extMatch","toLowerCase","inputMatch","outputMatch","cleanInput","cleanOutput","srcFileExtensionMapping","loadPlugins","loadPluginFromScript","pluginLoc","loadPluginFromConfig","pluginRef","build","resources","css","optimize","srcDirectory","buildDirectory","destDirectory","jsFilePaths","defaultBuildScript","validatePlugin","cmd","isArray","handleConfigError","watchCmd","runScriptPlugin","watch","buildScriptPlugin","ref","pluginName","pluginOptions","needsDefaultPlugin","arr","a","delete","unshift","extensionMap","inputExt","handleLegacyProxyScripts","scriptId","cmdArr","shift","yargs","toUrl","fromUrl","normalizeProxies","proxies","pathPrefix","on","proxyReq","req","proxyPath","changeOrigin","normalizeMount","mountedDirs","mountDir","mountUrl","normalizeAlias","createMountAlias","cleanAlias","removeTrailingSlash","normalizeConfig","addTrailingSlash","addLeadingSlash","removeLeadingSlash","isLegacyMountConfig","_extensionMap","handleValidationErrors","errors","handleDeprecatedConfigError","mainMsg","msgs","validateConfigAgainstV1","rawConfig","cliFlags","include","entrypoints","stat","k","dist","hash","nomodule","nomoduleOutput","babel","strict","validatePluginLoadResult","unexpectedOutput","fileExt","createConfiguration","validationErrors","validate","propertyName","allowUnknownAttributes","mergedConfig","merge","loadAndValidateConfig","explorerSync","cosmiconfigSync","searchPlaces","stopDir","search","isEmpty","cliConfig","extendConfig","extendConfigLoc","extendResult","extendValidation","extendConfgDir","absName","splice","homepage","webDependencyName","dependencies","devDependencies","configResult","getInputsFromOutput","potentialInputs","inp","runPipelineLoadStep","srcPath","messageBus","isHmrEnabled","srcExt","step","emit","mainOutputExt","runPipelineTransformStep","rootFileName","destExt","destBuildFile","runPipelineOptimizeStep","level","buildFile","buildFileOptions","loadResult","transformResult","getImportStats","dirLoc","importedFileOnDisk","resolveSourceSpecifier","isDirectory","trailingSlash","createImportResolver","dependencyImportMap","importResolver","importStats","importMapEntry","spliceString","withSlice","start","end","slice","scanCodeImportsExports","transformEsmImports","_code","replaceImport","rewrittenCode","reverse","rewrittenImport","transformHtmlImports","scriptTag","scriptCode","transformFileImports","installOptimizedDependencies","allFilesToResolveImports","installDest","installConfig","installResult","installRunner","EventEmitter","logEvent","args","logger","stdout","util","buildDirectoryLoc","internalFilesBuildLoc","relDest","runPlugin","dirDest","allFiles","dot","allBuildNeededFiles","f","allBuiltFromFiles","buildStart","outLoc","builtLocOnDisk","builtFileOutput","cssOutPath","recursive","buildEnd","allImportProxyFiles","resolveImportSpecifier","resolvedCode","resolvedImportUrl","extName","isProxyImport","isAbsoluteUrlPath","importProxyFileLoc","originalFileLoc","proxiedExt","proxiedCode","proxiedUrl","proxyCode","minifierStart","minifierService","esbuildStartService","allJsFiles","jsFile","jsFileContents","minifierEnd","EsmHmrEngine","clients","dependencyTree","Map","wss","server","WebSocket","Server","noServer","socket","head","handleUpgrade","client","connectClient","registerListener","entry","getEntry","isHmrAccepted","createEntry","sourceUrl","newEntry","dependents","needsReplacement","set","createIfNotFound","setEntry","outdatedDependencies","addRelationship","removeRelationship","importResult","sourceResult","markEntryForReplacement","state","broadcastMessage","readyState","OPEN","send","disconnectClient","terminate","disconnectAllClients","getPort","defaultPort","bestAvailablePort","detectPort","useNextPort","isTTY","rl","readline","createInterface","stdin","question","answer","close","getStateString","workerState","isWatch","done","WORKER_BASE_STATE","paint","bus","buildMode","devMode","startTimeMs","ips","consoleOutput","installOutput","isInstalling","hasBeenCleared","missingWebModule","allWorkerStates","allFileBuilds","setupWorker","repaint","isServerStarted","ip","didPrintDashboard","dotLength","dots","fmt","stateString","colorsFn","overallStatus","isBuilding","emitKeypressEvents","addPackage","HMR_DEV_CODE","DEFAULT_PROXY_ERROR_HANDLER","res","reqUrl","sendError","shouldProxy","reqPath","decodeURI","sendFile","ETag","weak","contentType","Vary","writeHead","acceptEncoding","method","isCompressible","onError","stream","Readable","bodyStream","pipeline","createGzip","status","getUrlFromFile","mountedDirectories","dirUrl","resolvedDirUrl","currentlyRunningCommand","isHmr","serverStart","Date","inMemoryBuildCache","filesBeingDeleted","filesBeingBuilt","isLiveReloadPaused","npmRunPath","extendEnv","stderr","installCommandOptions","clear","dependencyImportMapLoc","reinstallDependencies","devProxies","proxyOptions","proxyServer","HttpProxy","createProxyServer","onEventName","eventHandler","readCredentials","cert","credentials","requestHandler","reqUrlHmrParam","originalReqPath","isProxyModule","web","attemptedFileLoads","attemptLoadFile","requestedFile","isFile","requestedFileExt","responseFileExt","isRoute","getFileFromUrl","fallbackFile","potentialSourceFile","prefix","existingBuilderPromise","fileBuilderPromise","_buildFile","wrapResponse","hasCssResource","node","hmrEngine","rawImports","resolvedImports","resolveResponseImports","responseExt","wrappedResponse","doesPackageExist","finalizeResponse","hasAttachedCss","hotCachedResponse","responseContent","fileContents","cachedBuildData","has","originalFileHash","newFileHash","coldCachedResponse","checkFinalBuildResult","equals","responseOutput","createServer","http2","createSecureServer","allowHTTP1","https","http","isWebSocket","ws","listen","onProcessExit","updateOrBubble","visited","handleHmrUpdate","updateUrl","virtualCssFileUrl","virtualNode","os","networkInterfaces","every","i","family","internal","address","chokidar","onWatchEvent","watcher","ignored","persistent","ignoreInitial","disableGlobbing","symlinkedFileLocs","onDepWatchEvent","depWatcher","printHelp","cli","array","help","reload","buildCommand","devCommand"],"mappings":"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"}